# 🛡️ 노트 정비소 백업 및 복구 절차

## 🚨 긴급 상황 대응 체크리스트

### 즉시 해야 할 것들
- [ ] **작업 중단**: 추가 피해 방지
- [ ] **현재 상태 스냅샷**: 전체 폴더 복사
- [ ] **문제 상황 기록**: 작업추적.txt 업데이트
- [ ] **롤백 계획 수립**: 복구 우선순위 결정

### 절대 하면 안 되는 것들  
- ❌ **추가 삭제 작업**: 상황을 더 악화시킴
- ❌ **자동 복구 시도**: 검증 없는 복구는 위험
- ❌ **여러 파일 동시 수정**: 문제 추적 어려움

## 📁 백업 전략

### 1. 자동 백업 시스템
```javascript
// backup-system.js
class AutoBackup {
    constructor() {
        this.backupInterval = 30 * 60 * 1000; // 30분마다
        this.maxBackups = 24; // 12시간분 보관
        this.criticalFiles = [
            'workspace/current-note/',
            'garage-ide.html',
            'demo.html',
            'smartnote-integration.html',
            '작업추적.txt'
        ];
    }
    
    startAutoBackup() {
        setInterval(() => {
            this.createBackup();
        }, this.backupInterval);
    }
    
    createBackup() {
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
        const backupPath = `backups/auto-${timestamp}/`;
        
        this.criticalFiles.forEach(file => {
            // 파일 복사 로직
            this.copyFile(file, backupPath + file);
        });
    }
}
```

### 2. 수동 백업 프로세스
```bash
# 중요 작업 전 백업 생성
backup-create() {
    BACKUP_NAME="manual-$(date +%Y%m%d-%H%M%S)"
    mkdir -p "backups/$BACKUP_NAME"
    
    # 핵심 파일들 백업
    cp -r workspace/ "backups/$BACKUP_NAME/"
    cp *.html "backups/$BACKUP_NAME/"
    cp *.md "backups/$BACKUP_NAME/"
    cp 작업추적.txt "backups/$BACKUP_NAME/"
    
    echo "✅ 백업 생성 완료: $BACKUP_NAME"
}
```

### 3. Git 기반 버전 관리
```bash
# 커밋 전 체크리스트
git-safe-commit() {
    # 1. 현재 상태 확인
    git status
    
    # 2. 테스트 실행
    npm test
    
    # 3. 백업 생성
    backup-create
    
    # 4. 안전한 커밋
    git add .
    git commit -m "작업: $1 (백업: $(date +%Y%m%d-%H%M%S))"
}
```

## 🔄 복구 절차

### Level 1: 파일 단위 복구
```bash
# 특정 파일 복구
restore-file() {
    FILE_NAME=$1
    BACKUP_DATE=$2
    
    echo "📂 백업에서 $FILE_NAME 복구 중..."
    
    if [ -f "backups/$BACKUP_DATE/$FILE_NAME" ]; then
        cp "backups/$BACKUP_DATE/$FILE_NAME" "$FILE_NAME"
        echo "✅ $FILE_NAME 복구 완료"
    else
        echo "❌ 백업 파일을 찾을 수 없습니다"
    fi
}
```

### Level 2: 폴더 단위 복구  
```bash
# workspace 폴더 전체 복구
restore-workspace() {
    BACKUP_DATE=$1
    
    echo "🔄 workspace 폴더 복구 중..."
    
    # 현재 폴더 백업 (2차 안전장치)
    mv workspace/ "workspace-damaged-$(date +%H%M%S)/"
    
    # 백업에서 복구
    cp -r "backups/$BACKUP_DATE/workspace/" ./
    
    echo "✅ workspace 복구 완료"
}
```

### Level 3: 전체 시스템 복구
```bash
# 전체 프로젝트 복구
restore-full-system() {
    BACKUP_DATE=$1
    
    echo "🚨 전체 시스템 복구 시작..."
    
    # 현재 상태 보존
    mv note-garage/ "note-garage-damaged-$(date +%Y%m%d-%H%M%S)/"
    
    # 백업에서 전체 복구
    cp -r "backups/$BACKUP_DATE/" note-garage/
    
    # 의존성 재설치
    cd note-garage/
    npm install
    
    echo "✅ 전체 시스템 복구 완료"
}
```

## 🏥 복구 시나리오별 가이드

### 시나리오 1: 중요 파일 삭제
**상황**: demo.html, garage-ide.html 등 삭제
```bash
# 1. 백업 목록 확인
ls backups/ | sort -r

# 2. 최근 백업에서 복구
restore-file "demo.html" "auto-2025-08-07T14-30-00"
restore-file "garage-ide.html" "auto-2025-08-07T14-30-00"

# 3. 작동 테스트
open garage-ide.html
```

### 시나리오 2: 코드 파일 손상
**상황**: workspace/current-note/ 내 파일들 손상
```bash
# 1. 손상된 폴더 격리
mv workspace/current-note/ workspace/current-note-damaged/

# 2. 백업에서 복구
restore-workspace "manual-2025-08-07-140000"

# 3. 변경사항 확인
diff -r workspace/current-note-damaged/ workspace/current-note/
```

### 시나리오 3: 전체 시스템 붕괴
**상황**: 여러 폴더 삭제, 구조 파괴
```bash
# 1. 긴급 상황 선언
echo "🚨 EMERGENCY: 전체 시스템 복구 모드"

# 2. 전체 복구 실행  
restore-full-system "manual-2025-08-07-120000"

# 3. 시스템 재시작
npm run dev

# 4. 기능 테스트
./test-all-features.sh
```

## 📊 백업 모니터링

### 백업 상태 확인
```bash
backup-status() {
    echo "📊 백업 시스템 상태 확인"
    echo "========================"
    
    # 최근 백업들 표시
    echo "🕒 최근 자동 백업:"
    ls backups/ | grep "auto-" | sort -r | head -5
    
    echo ""
    echo "👤 최근 수동 백업:"
    ls backups/ | grep "manual-" | sort -r | head -3
    
    echo ""
    echo "📁 백업 용량:"
    du -sh backups/
    
    echo ""
    echo "⚠️ 주의사항: 백업이 24시간 이상 오래되었다면 새 백업을 생성하세요"
}
```

### 백업 정리
```bash
cleanup-old-backups() {
    echo "🧹 오래된 백업 정리 중..."
    
    # 7일 이상 된 자동 백업 삭제
    find backups/ -name "auto-*" -mtime +7 -exec rm -rf {} \;
    
    # 30일 이상 된 수동 백업 삭제 (확인 후)
    find backups/ -name "manual-*" -mtime +30 -ls
    
    echo "✅ 백업 정리 완료"
}
```

## ⚡ 긴급 연락 체계

### 복구 불가능 상황
1. **즉시 작업 중단**
2. **현재 상태 보존**: 추가 변경 금지
3. **전문가 연락**: 시스템 관리자 또는 개발팀
4. **상황 문서화**: 정확한 문제 상황 기록

### 복구 후 체크리스트
- [ ] 모든 핵심 기능 작동 확인
- [ ] 데이터 일관성 검증
- [ ] 성능 이상 여부 확인
- [ ] 사용자 접근 가능 여부 확인
- [ ] 작업추적.txt에 복구 과정 기록

---
**중요**: 이 문서는 정기적으로 업데이트하고, 실제 복구 훈련을 통해 절차를 검증해야 합니다!