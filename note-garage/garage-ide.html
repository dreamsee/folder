<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš— ë…¸íŠ¸ ì •ë¹„ì†Œ - ê°„í¸ IDE</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            overflow: hidden;
            background: #f5f5f5;
        }
        
        /* ìƒë‹¨ íˆ´ë°” */
        .toolbar {
            height: 60px;
            background: white;
            border-bottom: 1px solid #ddd;
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .logo {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }
        
        .toolbar-separator {
            width: 1px;
            height: 30px;
            background: #ddd;
        }
        
        .toolbar-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            background: #f8f9fa;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .toolbar-btn:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }
        
        .toolbar-btn.primary {
            background: #007bff;
            color: white;
        }
        
        .toolbar-btn.primary:hover {
            background: #0056b3;
        }
        
        .toolbar-btn.success {
            background: #28a745;
            color: white;
        }
        
        .toolbar-btn.success:hover {
            background: #218838;
        }
        
        .toolbar-btn.warning {
            background: #ff9800;
            color: white;
        }
        
        .toolbar-btn.warning:hover {
            background: #f57c00;
        }
        
        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        .main-container {
            display: flex;
            height: calc(100vh - 60px);
        }
        
        /* ì™¼ìª½: AI ì±„íŒ… íŒ¨ë„ */
        .chat-panel {
            width: 30%;
            background: white;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
            font-weight: 600;
            color: #333;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px 20px;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .chat-input-area {
            padding: 15px 20px;
            border-top: 1px solid #ddd;
            background: #f8f9fa;
        }
        
        .chat-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            resize: none;
            font-size: 14px;
            min-height: 40px;
        }
        
        .chat-send-btn {
            margin-top: 8px;
            width: 100%;
            padding: 8px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .chat-send-btn:hover {
            background: #0056b3;
        }
        
        /* ê°€ìš´ë°: ì½”ë“œ í¸ì§‘ê¸° */
        .editor-panel {
            width: 40%;
            background: white;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
        }
        
        .editor-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
        }
        
        .editor-tab {
            padding: 10px 16px;
            background: #f8f9fa;
            border: none;
            border-right: 1px solid #ddd;
            cursor: pointer;
            font-size: 14px;
            color: #666;
        }
        
        .editor-tab.active {
            background: white;
            color: #333;
            font-weight: 500;
        }
        
        .editor-content {
            flex: 1;
            position: relative;
        }
        
        .code-editor {
            width: 100%;
            height: 100%;
            border: none;
            padding: 15px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: none;
            outline: none;
            background: white;
        }
        
        /* ì˜¤ë¥¸ìª½: ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° */
        .preview-panel {
            width: 30%;
            background: white;
            display: flex;
            flex-direction: column;
        }
        
        .preview-header {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
            font-weight: 600;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .preview-refresh {
            padding: 4px 8px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .preview-content {
            flex: 1;
            overflow: auto;
            border: none;
        }
        
        /* ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        .message {
            margin-bottom: 12px;
        }
        
        .message.user {
            text-align: right;
        }
        
        .message.ai {
            text-align: left;
        }
        
        .message-content {
            display: inline-block;
            padding: 8px 12px;
            border-radius: 12px;
            max-width: 80%;
        }
        
        .message.user .message-content {
            background: #007bff;
            color: white;
        }
        
        .message.ai .message-content {
            background: #e9ecef;
            color: #333;
        }
    </style>
</head>
<body>
    <!-- ìƒë‹¨ íˆ´ë°” -->
    <div class="toolbar">
        <div class="logo">ğŸš— ë…¸íŠ¸ ì •ë¹„ì†Œ</div>
        <div class="toolbar-separator"></div>
        
        <!-- í¸ì§‘ ë„êµ¬ë“¤ (ì˜¬ë°”ë¥¸ ìœ„ì¹˜!) -->
        <button class="toolbar-btn warning" onclick="toggleVisualSelection()">
            ğŸ¯ ì§ì ‘ì„ íƒ
        </button>
        <button class="toolbar-btn success" onclick="generateChangeReport()">
            ğŸ“‹ ë³€ê²½ë¦¬í¬íŠ¸
        </button>
        <button class="toolbar-btn" onclick="resetChanges()">
            ğŸ”„ ì´ˆê¸°í™”
        </button>
        
        <div class="toolbar-separator"></div>
        
        <button class="toolbar-btn primary" onclick="runCode()">
            â–¶ï¸ ì‹¤í–‰
        </button>
        <button class="toolbar-btn" onclick="refreshPreview()">
            ğŸ”„ ìƒˆë¡œê³ ì¹¨
        </button>
    </div>
    
    <!-- ë©”ì¸ 3ë¶„í•  ë ˆì´ì•„ì›ƒ -->
    <div class="main-container">
        <!-- ì™¼ìª½: AI ì±„íŒ… íŒ¨ë„ -->
        <div class="chat-panel">
            <div class="chat-header">
                ğŸ¤– AI ì •ë¹„ì‚¬ì™€ ëŒ€í™”
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message ai">
                    <div class="message-content">
                        ì•ˆë…•í•˜ì„¸ìš”! ë…¸íŠ¸ ì •ë¹„ì†Œì…ë‹ˆë‹¤ ğŸš—âœ¨<br>
                        ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?<br><br>
                        ë‹¤ìŒê³¼ ê°™ì´ ë§í•´ë³´ì„¸ìš”:<br>
                        â€¢ "ë°°ê²½ì„ íŒŒë€ìƒ‰ìœ¼ë¡œ ë°”ê¿”ì¤˜"<br>
                        â€¢ "ì œëª©ì„ ë” í¬ê²Œ ë§Œë“¤ì–´ì¤˜"<br>
                        â€¢ "ë²„íŠ¼ ìƒ‰ìƒì„ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í•´ì¤˜"
                    </div>
                </div>
            </div>
            <div class="chat-input-area">
                <textarea class="chat-input" placeholder="AIì—ê²Œ ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”..." id="chatInput"></textarea>
                <button class="chat-send-btn" onclick="sendMessage()">ì „ì†¡</button>
            </div>
        </div>
        
        <!-- ê°€ìš´ë°: ì½”ë“œ í¸ì§‘ê¸° -->
        <div class="editor-panel">
            <div class="editor-tabs">
                <button class="editor-tab active" data-file="html">index.html</button>
                <button class="editor-tab" data-file="css">style.css</button>
                <button class="editor-tab" data-file="js">script.js</button>
            </div>
            <div class="editor-content">
                <textarea class="code-editor" id="htmlEditor" placeholder="HTML ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                <textarea class="code-editor" id="cssEditor" style="display: none;" placeholder="CSS ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                <textarea class="code-editor" id="jsEditor" style="display: none;" placeholder="JavaScript ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            </div>
        </div>
        
        <!-- ì˜¤ë¥¸ìª½: ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° -->
        <div class="preview-panel">
            <div class="preview-header">
                ğŸ’» ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°
                <button class="preview-refresh" onclick="refreshPreview()">ìƒˆë¡œê³ ì¹¨</button>
            </div>
            <iframe class="preview-content" id="previewFrame" src="demo.html"></iframe>
        </div>
    </div>
    
    <script>
        // íƒ­ ì „í™˜
        document.querySelectorAll('.editor-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // íƒ­ í™œì„±í™”
                document.querySelectorAll('.editor-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // ì—ë””í„° ì „í™˜
                document.querySelectorAll('.code-editor').forEach(editor => {
                    editor.style.display = 'none';
                });
                
                const fileType = tab.dataset.file;
                document.getElementById(fileType + 'Editor').style.display = 'block';
            });
        });
        
        // í† í° ë³´í˜¸ ì‹œìŠ¤í…œ
        class TokenProtectionSystem {
            constructor() {
                this.userRequests = [];
                this.warningCount = 0;
                this.isBlocked = false;
                this.blockUntil = null;
                
                // ë¹„ë””ìì¸ í‚¤ì›Œë“œ (ë¡œì»¬ì—ì„œ ì¦‰ì‹œ ì°¨ë‹¨)
                this.nonDesignKeywords = [
                    // ê¸°ìˆ /ë³´ì•ˆ ê´€ë ¨
                    'api', 'server', 'database', 'login', 'password', 'hack',
                    'sql', 'inject', 'security', 'admin', 'root', 'config',
                    'í•´í‚¹', 'ë³´ì•ˆ', 'ì„œë²„', 'ë°ì´í„°ë² ì´ìŠ¤', 'ë¡œê·¸ì¸', 'ë¹„ë°€ë²ˆí˜¸',
                    
                    // ì¼ë°˜ ì¡ë‹´ (ë‚ ì”¨, ê²½ì œ, ì—°ì˜ˆ ë“±)
                    'weather', 'economy', 'stock', 'celebrity', 'movie', 'music',
                    'sports', 'politics', 'news', 'food', 'travel', 'health',
                    'ë‚ ì”¨', 'ê²½ì œ', 'ì£¼ì‹', 'ì—°ì˜ˆì¸', 'ì˜í™”', 'ìŒì•…', 'ìŠ¤í¬ì¸ ',
                    'ì •ì¹˜', 'ë‰´ìŠ¤', 'ìŒì‹', 'ì—¬í–‰', 'ê±´ê°•', 'ì½”ë¡œë‚˜', 'ì„ ê±°',
                    
                    // ê°œì¸ì  ì§ˆë¬¸
                    'age', 'personal', 'private', 'relationship', 'family',
                    'ë‚˜ì´', 'ê°œì¸', 'ì‚¬ìƒí™œ', 'ì—°ì• ', 'ê°€ì¡±', 'ì‚¬ë‘', 'ê²°í˜¼',
                    
                    // ì¼ë°˜ ìƒì‹/êµìœ¡
                    'homework', 'study', 'school', 'university', 'exam',
                    'ìˆ™ì œ', 'ê³µë¶€', 'í•™êµ', 'ëŒ€í•™êµ', 'ì‹œí—˜', 'êµìœ¡', 'ì—­ì‚¬'
                ];
                
                // ë””ìì¸ í‚¤ì›Œë“œ (í—ˆìš©ë˜ëŠ” ì§ˆë¬¸ë“¤)
                this.designKeywords = [
                    // CSS ì†ì„± ê´€ë ¨
                    'color', 'background', 'font', 'size', 'margin', 'padding',
                    'border', 'width', 'height', 'position', 'layout', 'style',
                    'shadow', 'radius', 'opacity', 'transform', 'animation',
                    
                    // í•œêµ­ì–´ ë””ìì¸ ìš©ì–´
                    'ìƒ‰ìƒ', 'ë°°ê²½', 'ê¸€ê¼´', 'í¬ê¸°', 'ì—¬ë°±', 'í…Œë‘ë¦¬', 'ìœ„ì¹˜',
                    'ìŠ¤íƒ€ì¼', 'ë””ìì¸', 'ê¾¸ë¯¸ê¸°', 'ì˜ˆì˜ê²Œ', 'ì´ì˜ê²Œ', 'ëª¨ì–‘',
                    'ë²„íŠ¼', 'ì œëª©', 'ê¸€ì', 'í…ìŠ¤íŠ¸', 'ì´ë¯¸ì§€', 'ì‚¬ì§„',
                    
                    // ë””ìì¸ ë™ì‘
                    'change', 'modify', 'edit', 'update', 'adjust', 'set',
                    'ë°”ê¿”', 'ë³€ê²½', 'ìˆ˜ì •', 'ì¡°ì •', 'ì„¤ì •', 'ë§Œë“¤ì–´', 'í•´ì¤˜'
                ];
            }
            
            // 0ë‹¨ê³„: ë¡œì»¬ ì¦‰ì‹œ ì°¨ë‹¨ (í† í° 0 ì†Œëª¨)
            getLocalFilterResponse(message) {
                const lowerMessage = message.toLowerCase();
                
                // ë¹„ë””ìì¸ í‚¤ì›Œë“œ ê²€ì‚¬
                const hasNonDesignKeyword = this.nonDesignKeywords.some(keyword => 
                    lowerMessage.includes(keyword.toLowerCase())
                );
                
                if (hasNonDesignKeyword) {
                    return {
                        isLocalResponse: true,
                        response: "ğŸ¨ ì €ëŠ” ì›¹í˜ì´ì§€ì˜ ìƒ‰ìƒ, ê¸€ê¼´, ë ˆì´ì•„ì›ƒ ë“± ë””ìì¸ë§Œ ë„ì™€ë“œë¦¬ëŠ” AIì…ë‹ˆë‹¤.\n\në‹¤ìŒê³¼ ê°™ì´ ì§ˆë¬¸í•´ë³´ì„¸ìš”:\nâ€¢ \"ë°°ê²½ì„ íŒŒë€ìƒ‰ìœ¼ë¡œ ë°”ê¿”ì¤˜\"\nâ€¢ \"ì œëª© ê¸€ê¼´ì„ í¬ê²Œ í•´ì¤˜\"\nâ€¢ \"ë²„íŠ¼ ìƒ‰ìƒì„ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í•´ì¤˜\""
                    };
                }
                
                // ë””ìì¸ í‚¤ì›Œë“œê°€ ì—†ìœ¼ë©´ ì˜ì‹¬
                const hasDesignKeyword = this.designKeywords.some(keyword =>
                    lowerMessage.includes(keyword.toLowerCase())
                );
                
                if (!hasDesignKeyword && message.length > 5) {
                    return {
                        isLocalResponse: true,
                        response: "ğŸ¨ ì €ëŠ” ì›¹í˜ì´ì§€ **ë””ìì¸ ì „ìš©** AIì…ë‹ˆë‹¤.\n\nâŒ **ë‹µë³€í•˜ì§€ ì•ŠëŠ” ì§ˆë¬¸ë“¤:**\nâ€¢ ë‚ ì”¨, ê²½ì œ, ì—°ì˜ˆì¸ ì†Œì‹\nâ€¢ ê°œì¸ì ì¸ ì§ˆë¬¸ë“¤\nâ€¢ ì¼ë°˜ ìƒì‹ì´ë‚˜ ê³µë¶€ ë¬¸ì œ\n\nâœ… **ë„ì™€ë“œë¦¬ëŠ” ì‘ì—…ë“¤:**\nâ€¢ \"ë°°ê²½ìƒ‰ì„ íŒŒë€ìƒ‰ìœ¼ë¡œ ë°”ê¿”ì¤˜\"\nâ€¢ \"ì œëª© ê¸€ê¼´ì„ í¬ê²Œ ë§Œë“¤ì–´ì¤˜\"\nâ€¢ \"ë²„íŠ¼ì„ ë” ì˜ˆì˜ê²Œ ê¾¸ë©°ì¤˜\"\nâ€¢ \"ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¡°ì ˆí•´ì¤˜\""
                    };
                }
                
                return { isLocalResponse: false };
            }
            
            // 1ë‹¨ê³„: ë ˆì´íŠ¸ ë¦¬ë¯¸íŒ…
            checkRateLimit() {
                const now = Date.now();
                const oneHour = 60 * 60 * 1000;
                
                // ì°¨ë‹¨ ìƒíƒœ í™•ì¸
                if (this.isBlocked && now < this.blockUntil) {
                    const remainingMinutes = Math.ceil((this.blockUntil - now) / 60000);
                    return {
                        allowed: false,
                        response: `âš ï¸ ê³¼ë„í•œ ìš”ì²­ìœ¼ë¡œ ì¸í•´ ì¼ì‹œì ìœ¼ë¡œ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.\n${remainingMinutes}ë¶„ í›„ì— ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`
                    };
                }
                
                // ì°¨ë‹¨ í•´ì œ
                if (this.isBlocked && now >= this.blockUntil) {
                    this.isBlocked = false;
                    this.warningCount = 0;
                    this.userRequests = [];
                }
                
                // ìµœê·¼ 1ì‹œê°„ ìš”ì²­ í•„í„°ë§
                this.userRequests = this.userRequests.filter(req => now - req.timestamp < oneHour);
                
                // ì‹œê°„ë‹¹ ì œí•œ í™•ì¸ (20ê°œ)
                if (this.userRequests.length >= 20) {
                    this.warningCount++;
                    
                    if (this.warningCount >= 3) {
                        // 24ì‹œê°„ ì°¨ë‹¨
                        this.isBlocked = true;
                        this.blockUntil = now + (24 * 60 * 60 * 1000);
                        
                        return {
                            allowed: false,
                            response: "ğŸš¨ ê³¼ë„í•œ ìš”ì²­ìœ¼ë¡œ ì¸í•´ 24ì‹œê°„ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.\në‚´ì¼ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
                        };
                    }
                    
                    return {
                        allowed: false,
                        response: `âš ï¸ ì‹œê°„ë‹¹ ìš”ì²­ í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. (${this.warningCount}/3 ê²½ê³ )\nì ì‹œ í›„ì— ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`
                    };
                }
                
                return { allowed: true };
            }
            
            // ìš”ì²­ ê¸°ë¡
            recordRequest(message) {
                this.userRequests.push({
                    timestamp: Date.now(),
                    message: message,
                    isDesign: this.isDesignRelated(message)
                });
            }
            
            // ë””ìì¸ ê´€ë ¨ ì—¬ë¶€ íŒë‹¨
            isDesignRelated(message) {
                const lowerMessage = message.toLowerCase();
                return this.designKeywords.some(keyword =>
                    lowerMessage.includes(keyword.toLowerCase())
                );
            }
        }
        
        // í† í° ë³´í˜¸ ì‹œìŠ¤í…œ ì¸ìŠ¤í„´ìŠ¤
        const tokenProtection = new TokenProtectionSystem();
        
        // ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡ (ë³´ì•ˆ ê°•í™”)
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;
            
            // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
            addMessage('user', message);
            input.value = '';
            
            // 0ë‹¨ê³„: ë¡œì»¬ í•„í„°ë§ (í† í° 0 ì†Œëª¨)
            const localFilter = tokenProtection.getLocalFilterResponse(message);
            if (localFilter.isLocalResponse) {
                setTimeout(() => {
                    addMessage('ai', localFilter.response);
                }, 500);
                return;
            }
            
            // 1ë‹¨ê³„: ë ˆì´íŠ¸ ë¦¬ë¯¸íŒ…
            const rateCheck = tokenProtection.checkRateLimit();
            if (!rateCheck.allowed) {
                setTimeout(() => {
                    addMessage('ai', rateCheck.response);
                }, 500);
                return;
            }
            
            // ìš”ì²­ ê¸°ë¡
            tokenProtection.recordRequest(message);
            
            // ì‹¤ì œ AI ì²˜ë¦¬ (ë””ìì¸ ê´€ë ¨ë§Œ)
            setTimeout(() => {
                const responses = [
                    'ë„¤, ë””ìì¸ì„ ë³€ê²½í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤! ğŸ¨',
                    'ì¢‹ì€ ì•„ì´ë””ì–´ë„¤ìš”! ë¯¸ë¦¬ë³´ê¸°ì—ì„œ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš” âœ¨',
                    'ìŠ¤íƒ€ì¼ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. ì–´ë– ì‹ ê°€ìš”? ğŸš€',
                    'ë” ë””ìì¸ ìˆ˜ì •ì´ í•„ìš”í•˜ì‹œë©´ ë§ì”€í•´ì£¼ì„¸ìš”! ğŸ’¡'
                ];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                addMessage('ai', randomResponse);
            }, 1000);
        }
        
        // ë©”ì‹œì§€ ì¶”ê°€
        function addMessage(type, text) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.innerHTML = text.replace(/\n/g, '<br>');
            
            messageDiv.appendChild(contentDiv);
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        // Enter í‚¤ë¡œ ë©”ì‹œì§€ ì „ì†¡
        document.getElementById('chatInput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        
        // ì½”ë“œ ì‹¤í–‰
        function runCode() {
            const htmlCode = document.getElementById('htmlEditor').value;
            const cssCode = document.getElementById('cssEditor').value;
            const jsCode = document.getElementById('jsEditor').value;
            
            const fullHtml = `
                <!DOCTYPE html>
                <html>
                <head>
                    <style>${cssCode}</style>
                </head>
                <body>
                    ${htmlCode}
                    <script>${jsCode}<\/script>
                </body>
                </html>
            `;
            
            const frame = document.getElementById('previewFrame');
            frame.srcdoc = fullHtml;
        }
        
        // ë¯¸ë¦¬ë³´ê¸° ìƒˆë¡œê³ ì¹¨
        function refreshPreview() {
            const frame = document.getElementById('previewFrame');
            frame.src = frame.src;
        }
        
        // ë¹„ì£¼ì–¼ ì„ íƒ ì‹œìŠ¤í…œ
        class VisualElementSelector {
            constructor() {
                this.isActive = false;
                this.selectedElement = null;
                this.hoveredElement = null;
                this.changeTracker = new ChangeHistoryManager();
            }
            
            toggle() {
                this.isActive = !this.isActive;
                const frame = document.getElementById('previewFrame');
                
                if (this.isActive) {
                    this.enableSelectionMode(frame);
                    document.querySelector('.toolbar-btn.warning').style.background = '#ff5722';
                    addMessage('ai', 'ğŸ¯ **ì§ì ‘ì„ íƒ ëª¨ë“œ í™œì„±í™”!**\n\në¯¸ë¦¬ë³´ê¸° í™”ë©´ì˜ ìš”ì†Œë¥¼ í´ë¦­í•˜ë©´ í¸ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                } else {
                    this.disableSelectionMode(frame);
                    document.querySelector('.toolbar-btn.warning').style.background = '#ff9800';
                    addMessage('ai', 'ì§ì ‘ì„ íƒ ëª¨ë“œê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            }
            
            enableSelectionMode(frame) {
                const frameDoc = frame.contentDocument || frame.contentWindow.document;
                frameDoc.body.style.cursor = 'crosshair';
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                frameDoc.addEventListener('mouseover', this.handleMouseOver.bind(this));
                frameDoc.addEventListener('mouseout', this.handleMouseOut.bind(this));
                frameDoc.addEventListener('click', this.handleClick.bind(this));
            }
            
            disableSelectionMode(frame) {
                const frameDoc = frame.contentDocument || frame.contentWindow.document;
                frameDoc.body.style.cursor = 'default';
                
                // í•˜ì´ë¼ì´íŠ¸ ì œê±°
                if (this.selectedElement) {
                    this.selectedElement.style.outline = '';
                    this.selectedElement = null;
                }
                if (this.hoveredElement) {
                    this.hoveredElement.style.outline = '';
                    this.hoveredElement = null;
                }
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
                frameDoc.removeEventListener('mouseover', this.handleMouseOver.bind(this));
                frameDoc.removeEventListener('mouseout', this.handleMouseOut.bind(this));
                frameDoc.removeEventListener('click', this.handleClick.bind(this));
            }
            
            handleMouseOver(event) {
                if (!this.isActive) return;
                event.stopPropagation();
                
                const element = event.target;
                if (element === this.selectedElement) return;
                
                // í˜¸ë²„ í•˜ì´ë¼ì´íŠ¸ (ì£¼í™©ìƒ‰ ì ì„ )
                this.hoveredElement = element;
                element.style.outline = '2px dashed #ff9800';
            }
            
            handleMouseOut(event) {
                if (!this.isActive) return;
                event.stopPropagation();
                
                const element = event.target;
                if (element === this.selectedElement) return;
                
                // í˜¸ë²„ í•˜ì´ë¼ì´íŠ¸ ì œê±°
                if (element === this.hoveredElement) {
                    element.style.outline = '';
                    this.hoveredElement = null;
                }
            }
            
            handleClick(event) {
                if (!this.isActive) return;
                event.preventDefault();
                event.stopPropagation();
                
                const element = event.target;
                
                // ì´ì „ ì„ íƒ ì œê±°
                if (this.selectedElement) {
                    this.selectedElement.style.outline = '';
                }
                
                // ìƒˆ ìš”ì†Œ ì„ íƒ (íŒŒë€ìƒ‰ ì‹¤ì„ )
                this.selectedElement = element;
                element.style.outline = '3px solid #2196f3';
                
                // í¸ì§‘ íŒ¨ë„ í‘œì‹œ
                this.showEditPanel(element);
            }
            
            showEditPanel(element) {
                const styles = window.getComputedStyle(element);
                const tagName = element.tagName.toLowerCase();
                const text = element.textContent || '';
                
                let editOptions = `
ğŸ¨ **ì„ íƒëœ ìš”ì†Œ: ${tagName}**

í˜„ì¬ ìŠ¤íƒ€ì¼:
â€¢ ë°°ê²½ìƒ‰: ${styles.backgroundColor}
â€¢ ê¸€ììƒ‰: ${styles.color}
â€¢ ê¸€ê¼´ í¬ê¸°: ${styles.fontSize}
â€¢ ì—¬ë°±: ${styles.padding}

ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
â€¢ "ë°°ê²½ì„ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ"
â€¢ "ê¸€ì í¬ê¸°ë¥¼ 20pxë¡œ"
â€¢ "ì—¬ë°±ì„ 10pxë¡œ"
â€¢ "í…ìŠ¤íŠ¸ë¥¼ 'ìƒˆë¡œìš´ ë‚´ìš©'ìœ¼ë¡œ"
                `;
                
                addMessage('ai', editOptions);
            }
        }
        
        // ë³€ê²½ì‚¬í•­ ì¶”ì  ì‹œìŠ¤í…œ
        class ChangeHistoryManager {
            constructor() {
                this.history = [];
                this.changeId = 0;
            }
            
            recordEdit(element, property, oldValue, newValue) {
                const change = {
                    id: ++this.changeId,
                    timestamp: new Date().toISOString(),
                    element: this.getElementSelector(element),
                    property: property,
                    oldValue: oldValue,
                    newValue: newValue
                };
                this.history.push(change);
                console.log('ë³€ê²½ ê¸°ë¡:', change);
            }
            
            getElementSelector(element) {
                if (element.id) return `#${element.id}`;
                if (element.className) return `.${element.className.split(' ')[0]}`;
                return element.tagName.toLowerCase();
            }
            
            generateMarkdownReport() {
                if (this.history.length === 0) {
                    return '# ë³€ê²½ ì´ë ¥ ì—†ìŒ\n\nì•„ì§ ë³€ê²½ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.';
                }
                
                let report = '# ğŸ“‹ ë³€ê²½ ë¦¬í¬íŠ¸\n\n';
                report += `**ìƒì„±ì¼ì‹œ:** ${new Date().toLocaleString('ko-KR')}\n`;
                report += `**ì´ ë³€ê²½ ìˆ˜:** ${this.history.length}ê°œ\n\n`;
                report += '## ë³€ê²½ ë‚´ì—­\n\n';
                
                this.history.forEach((change, index) => {
                    report += `### ${index + 1}. ${change.element}\n`;
                    report += `- **ì†ì„±:** ${change.property}\n`;
                    report += `- **ì´ì „ê°’:** ${change.oldValue}\n`;
                    report += `- **ë³€ê²½ê°’:** ${change.newValue}\n`;
                    report += `- **ì‹œê°„:** ${new Date(change.timestamp).toLocaleTimeString('ko-KR')}\n\n`;
                });
                
                report += '## CSS ì½”ë“œ ìƒì„±\n\n```css\n';
                const cssMap = new Map();
                
                this.history.forEach(change => {
                    if (!cssMap.has(change.element)) {
                        cssMap.set(change.element, {});
                    }
                    cssMap.get(change.element)[change.property] = change.newValue;
                });
                
                cssMap.forEach((styles, selector) => {
                    report += `${selector} {\n`;
                    Object.entries(styles).forEach(([prop, value]) => {
                        report += `    ${prop}: ${value};\n`;
                    });
                    report += '}\n\n';
                });
                
                report += '```\n';
                return report;
            }
            
            clearHistory() {
                this.history = [];
                this.changeId = 0;
            }
        }
        
        // ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
        const visualSelector = new VisualElementSelector();
        
        // íˆ´ë°” ê¸°ëŠ¥ë“¤
        function toggleVisualSelection() {
            visualSelector.toggle();
        }
        
        function generateChangeReport() {
            const report = visualSelector.changeTracker.generateMarkdownReport();
            
            // ì±„íŒ…ì°½ì— ë¦¬í¬íŠ¸ í‘œì‹œ
            addMessage('ai', report);
            
            // ì½˜ì†”ì—ë„ ì¶œë ¥
            console.log(report);
            
            // í´ë¦½ë³´ë“œì— ë³µì‚¬ (ê°€ëŠ¥í•œ ê²½ìš°)
            if (navigator.clipboard) {
                navigator.clipboard.writeText(report).then(() => {
                    addMessage('ai', 'ğŸ“‹ ë¦¬í¬íŠ¸ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                });
            }
        }
        
        function resetChanges() {
            if (confirm('ëª¨ë“  ë³€ê²½ì‚¬í•­ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                document.getElementById('htmlEditor').value = '';
                document.getElementById('cssEditor').value = '';
                document.getElementById('jsEditor').value = '';
                refreshPreview();
            }
        }
        
        // ì´ˆê¸° ì½”ë“œ ë¡œë“œ
        window.addEventListener('load', () => {
            // demo.htmlì—ì„œ ì½”ë“œ ê°€ì ¸ì˜¤ê¸° (ì¶”í›„ êµ¬í˜„)
            document.getElementById('htmlEditor').value = `<div class="container">
    <h1>ì•ˆë…•í•˜ì„¸ìš”! ë…¸íŠ¸ ì •ë¹„ì†Œì…ë‹ˆë‹¤ ğŸš—</h1>
    <p>AIì™€ í•¨ê»˜ ì´ í˜ì´ì§€ë¥¼ ìˆ˜ì •í•´ë³´ì„¸ìš”!</p>
    <button class="demo-button">í´ë¦­í•´ë³´ì„¸ìš”!</button>
</div>`;
            
            document.getElementById('cssEditor').value = `.container {
    max-width: 600px;
    margin: 0 auto;
    padding: 20px;
    text-align: center;
    font-family: Arial, sans-serif;
}

h1 {
    color: #333;
    margin-bottom: 20px;
}

.demo-button {
    background: #007bff;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
}`;
            
            document.getElementById('jsEditor').value = `document.addEventListener('DOMContentLoaded', function() {
    const button = document.querySelector('.demo-button');
    if (button) {
        button.addEventListener('click', function() {
            alert('ë²„íŠ¼ì´ í´ë¦­ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰');
        });
    }
});`;
        });
    </script>
</body>
</html>