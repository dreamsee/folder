# 🎯 정비소 실제 필요한 핵심 기능

## 🛡️ 보안 및 데이터 보호 (최우선)

### 1. **코드 추상화 및 해킹 방어**
```javascript
// 민감 정보 필터링
class CodeSecurityFilter {
  sanitizeCode(rawCode) {
    // 개인정보, API 키, 비밀번호 등 제거
    const sensitivePatterns = [
      /password\s*[:=]\s*['"][^'"]*['"]/gi,
      /api[_-]?key\s*[:=]\s*['"][^'"]*['"]/gi,
      /secret\s*[:=]\s*['"][^'"]*['"]/gi,
      /token\s*[:=]\s*['"][^'"]*['"]/gi
    ];
    
    return sensitivePatterns.reduce((code, pattern) => 
      code.replace(pattern, '[보안상 숨김]'), rawCode
    );
  }
  
  filterNonDesignElements(htmlCode) {
    // 디자인과 무관한 요소 제거
    const blacklistTags = ['script', 'form', 'input[type="password"]', 'iframe'];
    return this.removeBlacklistedElements(htmlCode, blacklistTags);
  }
}
```

### 2. **디자인 요소만 추출**
```javascript
class DesignElementExtractor {
  extractEditableElements(html) {
    const designElements = {
      colors: this.extractColors(html),
      fonts: this.extractFonts(html), 
      layouts: this.extractLayouts(html),
      spacing: this.extractSpacing(html),
      buttons: this.extractButtons(html),
      images: this.extractImages(html)
    };
    
    // 기능적 요소는 제외, 시각적 요소만
    return this.filterVisualOnly(designElements);
  }
  
  getEditableProperties(element) {
    const allowedProperties = [
      'color', 'background-color', 'font-size', 'font-family',
      'margin', 'padding', 'border', 'border-radius',
      'width', 'height', 'text-align', 'display'
    ];
    
    const blockedProperties = [
      'onclick', 'href', 'action', 'method', 'src'
    ];
    
    return allowedProperties; // 안전한 CSS 속성만
  }
}
```

## 🎨 디자인 전용 AI 역할 분리

### 3. **AI 역할 제한 시스템**
```javascript
class DesignOnlyAI {
  constructor() {
    this.allowedQuestions = [
      '색상', '배경', '글꼴', '크기', '위치', '버튼', '레이아웃'
    ];
    this.blockedQuestions = [
      '서버', '데이터베이스', 'API', '로그인', '해킹', '보안', '개인정보'
    ];
  }
  
  validateQuestion(userInput) {
    // 1차: 디자인 관련 키워드 확인
    const isDesignRelated = this.allowedQuestions.some(keyword => 
      userInput.includes(keyword)
    );
    
    // 2차: 금지 키워드 확인  
    const hasBlockedKeywords = this.blockedQuestions.some(keyword =>
      userInput.includes(keyword)
    );
    
    if (!isDesignRelated || hasBlockedKeywords) {
      return {
        allowed: false,
        response: "저는 웹페이지의 색상, 글꼴, 레이아웃 등 디자인만 도와드립니다."
      };
    }
    
    return { allowed: true };
  }
  
  processDesignRequest(userInput, currentStyles) {
    // 디자인 관련 요청만 처리
    return {
      cssChanges: this.generateCSSOnly(userInput),
      explanation: "디자인이 변경되었습니다.",
      preview: true
    };
  }
}
```

### 4. **디자인 요소 화면 비율 및 위치**
```javascript
class ResponsiveDesignHelper {
  analyzeLayout(element) {
    const rect = element.getBoundingClientRect();
    const parentRect = element.parentElement.getBoundingClientRect();
    
    return {
      position: {
        left: `${(rect.left / parentRect.width * 100).toFixed(1)}%`,
        top: `${(rect.top / parentRect.height * 100).toFixed(1)}%`
      },
      size: {
        width: `${(rect.width / parentRect.width * 100).toFixed(1)}%`,  
        height: `${(rect.height / parentRect.height * 100).toFixed(1)}%`
      },
      editableAspects: [
        '위치 조정', '크기 조절', '여백 설정', '색상 변경'
      ]
    };
  }
  
  showOnlyDesignProperties(element) {
    // 디자인적 요소만 편집 가능하게 표시
    const editPanel = {
      colors: ['배경색', '글자색', '테두리색'],
      typography: ['글꼴', '글자 크기', '글자 굵기'],
      layout: ['위치', '크기', '여백', '정렬'],
      effects: ['그림자', '둥근 모서리', '투명도']
    };
    
    return editPanel;
  }
}
```

## 🚫 금지 기능 명확화

### 5. **절대 허용하지 않는 것들**
```javascript
const BLOCKED_OPERATIONS = {
  // 보안 관련
  security: ['비밀번호', 'API 키', '토큰', '인증', '로그인'],
  
  // 기능적 요소  
  functionality: ['JavaScript 함수', '이벤트 핸들러', 'Ajax 호출', '폼 처리'],
  
  // 개인정보
  privacy: ['이메일', '전화번호', '주소', '개인정보', '쿠키'],
  
  // 시스템 접근
  system: ['파일 시스템', '서버 정보', '데이터베이스', '환경변수']
};

function isBlockedOperation(userInput) {
  return Object.values(BLOCKED_OPERATIONS)
    .flat()
    .some(blocked => userInput.includes(blocked));
}
```

### 6. **허용되는 디자인 작업만**
```javascript
const ALLOWED_DESIGN_OPERATIONS = {
  // 시각적 스타일
  visual: {
    colors: ['배경색 변경', '글자색 조정', '테두리색 설정'],
    typography: ['글꼴 변경', '글자 크기 조절', '글자 간격 조정'],
    layout: ['위치 이동', '크기 조절', '정렬 변경', '여백 조정'],
    effects: ['그림자 추가', '둥근 모서리', '투명도 조절']
  },
  
  // 레이아웃 구조
  structure: ['요소 배치', '비율 조정', '반응형 설정'],
  
  // 버튼 및 UI
  interface: ['버튼 스타일', '호버 효과', '클릭 스타일']
};
```

## 🎯 핵심 구현 우선순위

### 1순위 (보안)
- [x] 코드 추상화 및 민감정보 필터링
- [x] AI 역할 제한 (디자인만)
- [x] 금지 키워드 차단

### 2순위 (기능)  
- [x] 디자인 요소만 추출
- [x] 화면 비율 및 위치 시스템
- [x] 편집 가능 속성 제한

### 3순위 (UX)
- [ ] 실시간 미리보기
- [ ] 변경사항 추적
- [ ] 되돌리기/다시하기

---

**💡 핵심 철학:**
"디자인만 건드리고, 보안은 철벽방어, 기능은 건드리지 않는다"