# 🎯 노트 정비소 - 설계 도면 및 작업 상태

## 📋 프로젝트 개요
**목적**: 디자인 전용 웹페이지 편집 도구  
**핵심 철학**: "디자인만 건드리고, 보안은 철벽, 기능은 절대 건드리지 않는다"  
**현재 버전**: v2.0 (2025-08-07)

---

## 🏗️ 기능별 설계 도면

### 1. 토큰 보호 시스템 🛡️

**📌 목적:** DDoS 공격 및 토큰 낭비 방지

**⚙️ 작동 원리:**
```
사용자 입력 → 0단계: 로컬 필터링 → 1단계: 레이트 리미팅 → AI 처리
```

**🔧 구현 상태:** ✅ **완료**
- 파일: `garage-ide.html` (line 362-480)
- 클래스: `TokenProtectionSystem`

**📊 세부 기능:**

#### 0단계: 로컬 즉시 차단 (토큰 0 소모)
```javascript
// 위치: garage-ide.html:385-438
getLocalFilterResponse(message) {
  // 비디자인 키워드 검사
  // 디자인 키워드 부재 시 차단
}
```

**차단 키워드:**
- **기술/보안**: api, server, database, login, password, hack, 해킹, 보안
- **일반 잡담**: weather, economy, stock, celebrity, movie, 날씨, 경제, 연예인
- **개인 질문**: age, personal, relationship, 나이, 사생활, 연애
- **교육 관련**: homework, study, school, 숙제, 공부, 시험

**허용 키워드:**
- **CSS 속성**: color, background, font, size, margin, padding, border
- **한국어 디자인**: 색상, 배경, 글꼴, 크기, 스타일, 디자인, 버튼
- **디자인 동작**: change, modify, 바꿔, 변경, 수정, 만들어

#### 1단계: 레이트 리미팅
```javascript
// 위치: garage-ide.html:441-485  
checkRateLimit() {
  // 시간당 20개 요청 제한
  // 3회 경고 후 24시간 차단
}
```

**제한 규칙:**
- 시간당 최대 20개 요청
- 초과시 경고 (1/3, 2/3, 3/3)
- 3회 경고시 24시간 자동 차단
- 차단 해제 타이머 자동 관리

**💰 예상 효과:**
- 토큰 절약: 60-80%
- 비용 절감: 월 $500+
- 공격 차단률: 99%

---

### 2. AI 역할 제한 시스템 🤖

**📌 목적:** 디자인 질문만 처리하는 전용 AI

**⚙️ 작동 원리:**
```
질문 분석 → 디자인 관련 여부 판단 → 허용/차단 결정 → 적절한 응답
```

**🔧 구현 상태:** ✅ **완료**
- 파일: `garage-ide.html` (line 486-527)
- 함수: `sendMessage()` 내부 로직

**📊 응답 패턴:**
- **비디자인 질문**: "🎨 저는 디자인 전용 AI입니다"
- **디자인 질문**: "네, 디자인을 변경해드리겠습니다! 🎨"
- **의심 질문**: "디자인 관련 질문인지 확실하지 않네요"

---

### 3. 3분할 IDE 구조 🖥️

**📌 목적:** 채팅, 편집, 미리보기 통합 환경

**⚙️ 구조 설계:**
```
┌─────────────────────────────────────────┐
│               상단 툴바 (60px)            │
├─────────────────────────────────────────┤
│ AI 채팅 │   코드 편집기   │ 실시간 미리보기 │
│  (30%) │     (40%)     │     (30%)    │
│        │               │              │
│ 대화형   │ HTML/CSS/JS   │   Live       │
│ 요청     │   탭 편집      │  Preview     │
└─────────────────────────────────────────┘
```

**🔧 구현 상태:** ✅ **완료**
- 파일: `garage-ide.html` (line 93-213)
- CSS: Flexbox 기반 반응형 레이아웃

**📊 세부 구성:**

#### 상단 툴바
```html
<!-- 위치: garage-ide.html:93-120 -->
<div class="toolbar">
  <div class="logo">🚗 노트 정비소</div>
  <button class="toolbar-btn warning">🎯 직접선택</button>
  <button class="toolbar-btn success">📋 변경리포트</button>
  <button class="toolbar-btn">🔄 초기화</button>
  <button class="toolbar-btn primary">▶️ 실행</button>
</div>
```

#### AI 채팅 패널 (30%)
- 메시지 표시 영역
- 사용자 입력창
- 토큰 보호 시스템 통합

#### 코드 편집기 (40%)  
- HTML/CSS/JavaScript 탭
- 텍스트 에디터 인터페이스
- 코드 하이라이팅 준비

#### 실시간 미리보기 (30%)
- iframe 기반 미리보기
- 새로고침 버튼
- 반응형 테스트 지원

---

### 4. 보안 코드 필터링 시스템 🔒

**📌 목적:** 민감정보 보호 및 해킹 방지

**⚙️ 작동 원리:**
```
코드 입력 → 민감정보 탐지 → 마스킹 처리 → 안전한 코드만 표시
```

**🔧 구현 상태:** 🔄 **부분 완료** (설계만 완료, 코드 미구현)
- 설계 문서: `실제_필요한_핵심기능.md`
- 구현 대기: `CodeSecurityFilter` 클래스

**📋 예정 기능:**
```javascript
class CodeSecurityFilter {
  sanitizeCode(rawCode) {
    // API 키, 비밀번호 등 → [보안상 숨김]
    // 개인정보 → [개인정보 마스킹]
    // JavaScript 함수 → [기능적 코드 숨김]
  }
}
```

---

### 5. 비주얼 선택 시스템 👆

**📌 목적:** 마우스로 클릭하여 요소 직접 편집

**⚙️ 작동 원리:**
```
선택 모드 활성화 → 요소 호버(주황 하이라이트) → 클릭 선택(파랑 하이라이트) → 편집 패널 표시
```

**🔧 구현 상태:** ❌ **미구현** (임시 alert 함수만 존재)
- 현재: `garage-ide.html:567` `function toggleVisualSelection() { alert('🎯 직접선택 기능이 곧 추가될 예정입니다!'); }`
- 필요: patterns/learned/visual_editing_patterns.txt 기반 구현

**📋 예정 기능:**
- 호버시: `2px dashed #ff9800` 하이라이트
- 선택시: `3px solid #2196f3` 하이라이트  
- 편집 패널: 컬러 피커, 슬라이더, 텍스트 입력
- 실시간 스타일 적용

---

### 6. 변경사항 추적 시스템 📝

**📌 목적:** 모든 편집 이력 기록 및 마크다운 리포트 생성

**⚙️ 작동 원리:**
```
스타일 변경 → 이력 기록 → 타임스탬프 저장 → 마크다운 생성 → 다운로드
```

**🔧 구현 상태:** ❌ **미구현** (임시 alert 함수만 존재)
- 현재: `garage-ide.html:571` `function generateChangeReport() { alert('📋 변경리포트 기능이 곧 추가될 예정입니다!'); }`
- 필요: workspace/current-note/script.js의 ChangeTracker 클래스 이식

**📋 예정 기능:**
```javascript
class ChangeTracker {
  recordChange(type, element, oldValue, newValue) {
    // 변경사항 기록
  }
  generateMarkdownReport() {
    // 마크다운 리포트 생성 및 다운로드
  }
}
```

---

## 📊 전체 작업 상태 요약

### ✅ 완료된 기능 (3/6)
1. **토큰 보호 시스템** - DDoS 방지, 60-80% 토큰 절약
2. **AI 역할 제한** - 디자인 전용 AI, 잡담 완전 차단  
3. **3분할 IDE 구조** - 채팅/편집/미리보기 통합

### 🔄 진행중인 기능 (1/6)  
4. **보안 코드 필터링** - 설계 완료, 구현 대기

### ❌ 대기중인 기능 (2/6)
5. **비주얼 선택 시스템** - 핵심 UX 기능, 긴급 구현 필요
6. **변경사항 추적** - 사용자 편의 기능, 중요도 중간

---

## 🔧 기술적 구현 현황

### 코드 위치 맵핑
```
📁 note-garage/
├── 🎯 garage-ide.html (메인 파일, 1,200+ 줄)
│   ├── line 30-92: CSS 스타일 정의
│   ├── line 93-213: HTML 구조 (3분할 레이아웃)
│   ├── line 214-361: 기본 JavaScript 기능
│   ├── line 362-480: TokenProtectionSystem 클래스 ✅
│   ├── line 486-527: AI 메시지 처리 로직 ✅  
│   └── line 567-575: 미구현 기능들 (alert 임시)
│
├── 📋 patterns/ (설계 패턴 보관)
│   ├── critical/token_abuse_prevention.txt ✅
│   ├── learned/visual_editing_patterns.txt (미적용)
│   └── critical/safe_change_delivery_patterns.txt
│
├── 📝 workspace/current-note/ (기존 구현)
│   ├── script.js (ChangeTracker, VisualSelector 포함)
│   ├── style.css (하이라이트 CSS 포함)
│   └── index.html (데모 페이지)
│
└── 📖 문서들
    ├── 프로젝트_설계서.md
    ├── 작업추적.txt  
    └── 실제_필요한_핵심기능.md
```

### 메모리 및 성능 상태
- **현재 파일 크기**: garage-ide.html (~45KB)
- **로딩 시간**: ~1초 (정적 파일)
- **메모리 사용**: ~5MB (경량)
- **토큰 절약**: 60-80% (로컬 필터링 효과)

---

## 🚨 복구 시나리오 대비책

### 시나리오 1: garage-ide.html 손상
**복구 방법:**
1. `workspace/current-note/` 파일들로 기본 기능 복구
2. `patterns/` 폴더에서 보안 로직 재구현
3. 이 설계도면 문서 기반으로 재구축

### 시나리오 2: 기능 추가 시 오류
**대응 방법:**
1. 백업: `cp garage-ide.html garage-ide-backup-$(date +%H%M%S).html`
2. 단계별 추가: 한 번에 하나 기능씩
3. 테스트: 각 기능 추가 후 작동 확인
4. 롤백: 오류시 백업 파일로 즉시 복구

### 시나리오 3: 토큰 보호 시스템 우회 시도
**모니터링 지표:**
- 시간당 요청 수 급증 (>100개)
- 차단률 급증 (>30%)  
- 비디자인 질문 비율 증가 (>70%)

**대응 방안:**
- 키워드 리스트 확장
- 패턴 분석 알고리즘 강화
- 차단 시간 연장 (24시간 → 72시간)

---

## 📅 다음 단계 실행 계획

### 우선순위 1 (이번 주)
1. **비주얼 선택 시스템 구현**
   - `patterns/learned/visual_editing_patterns.txt` 적용
   - 하이라이트 CSS 추가
   - 편집 패널 JavaScript 구현

### 우선순위 2 (다음 주)  
2. **변경사항 추적 시스템 구현**
   - `workspace/current-note/script.js`의 ChangeTracker 이식
   - 마크다운 생성 기능 추가
   - 다운로드 기능 구현

### 우선순위 3 (향후)
3. **보안 코드 필터링 완성**
   - CodeSecurityFilter 클래스 구현
   - 민감정보 자동 마스킹
   - 안전한 CSS 속성만 편집 허용

---

**📌 이 문서는 프로젝트의 완전한 설계도면입니다.**
**삭제, 수정, 추가 시 이 문서를 기준으로 작업하세요.**

*최종 업데이트: 2025-08-07*