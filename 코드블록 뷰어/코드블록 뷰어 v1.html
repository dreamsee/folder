<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“¦ ì½”ë“œ ë¸”ë¡ ë·°ì–´ - ì ‘ì—ˆë‹¤ í¼ì¹˜ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Consolas', 'Monaco', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* ì¢Œì¸¡ íŒŒì¼ íŠ¸ë¦¬ */
        .sidebar {
            width: 300px;
            background: #252526;
            border-right: 1px solid #3c3c3c;
            overflow-y: auto;
            resize: horizontal;
        }

        .upload-area {
            padding: 20px;
            border-bottom: 1px solid #3c3c3c;
            text-align: center;
        }

        .upload-zone {
            border: 2px dashed #007acc;
            border-radius: 8px;
            padding: 40px 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #2d2d30;
        }

        .upload-zone:hover,
        .upload-zone.dragover {
            background: #094771;
            border-color: #4fc3f7;
        }

        .upload-buttons {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .upload-btn {
            padding: 8px 16px;
            background: #0e639c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }

        .upload-btn:hover {
            background: #007acc;
        }

        .file-tree {
            padding: 10px;
        }

        .tree-item {
            padding: 4px 8px;
            cursor: pointer;
            border-radius: 3px;
            margin: 2px 0;
            user-select: none;
        }

        .tree-item:hover {
            background: #2a2d2e;
        }

        .tree-item.active {
            background: #094771;
            color: #fff;
        }

        .tree-item.folder {
            font-weight: bold;
            color: #4fc3f7;
        }

        .tree-item.file {
            padding-left: 20px;
            color: #d4d4d4;
        }

        .tree-item.file::before {
            content: "ğŸ“„ ";
            margin-right: 5px;
        }

        .tree-item.folder::before {
            content: "ğŸ“ ";
            margin-right: 5px;
        }

        .tree-item.folder.expanded::before {
            content: "ğŸ“‚ ";
        }

        /* ìš°ì¸¡ ì½”ë“œ ë·°ì–´ */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .toolbar {
            background: #2d2d30;
            padding: 10px 20px;
            border-bottom: 1px solid #3c3c3c;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-info {
            flex: 1;
            font-size: 14px;
            color: #cccccc;
        }

        .toolbar-btn {
            padding: 6px 12px;
            background: #0e639c;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .toolbar-btn:hover {
            background: #007acc;
        }

        .code-viewer {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #1e1e1e;
        }

        /* ì½”ë“œ ë¸”ë¡ ìŠ¤íƒ€ì¼ */
        .code-block {
            margin-bottom: 10px;
            border: 1px solid #3c3c3c;
            border-radius: 6px;
            background: #2d2d30;
        }

        .block-header {
            background: #383838;
            padding: 8px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-radius: 6px 6px 0 0;
            user-select: none;
        }

        .block-header:hover {
            background: #404040;
        }

        .block-title {
            font-weight: bold;
            color: #4fc3f7;
        }

        .block-info {
            font-size: 12px;
            color: #999;
        }

        .block-toggle {
            color: #fff;
            font-size: 14px;
            transition: transform 0.2s ease;
        }

        .block-toggle.collapsed {
            transform: rotate(-90deg);
        }

        .block-content {
            padding: 15px;
            background: #1e1e1e;
            border-radius: 0 0 6px 6px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .block-content.collapsed {
            height: 0;
            padding: 0 15px;
        }

        .block-preview {
            color: #999;
            font-size: 12px;
            padding: 8px 12px;
            background: #2d2d30;
            margin: 0;
            display: none;
        }

        .code-block.collapsed .block-preview {
            display: block;
        }

        pre {
            margin: 0;
            padding: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.4;
            color: #d4d4d4;
        }

        /* ë¬¸ë²• í•˜ì´ë¼ì´íŒ… */
        .keyword { color: #569cd6; font-weight: bold; }
        .string { color: #ce9178; }
        .comment { color: #6a9955; font-style: italic; }
        .number { color: #b5cea8; }
        .function { color: #dcdcaa; }
        .class { color: #4ec9b0; }
        .variable { color: #9cdcfe; }
        .operator { color: #d4d4d4; }
        .bracket { color: #ffd700; }

        /* ë¡œë”© ë° ìƒíƒœ */
        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #4fc3f7;
        }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #2d2d30;
        }

        ::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #777;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: 200px;
                resize: none;
            }
            
            .container {
                flex-direction: column;
            }
            
            .upload-zone {
                padding: 20px 10px;
            }
            
            .upload-buttons {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ì¢Œì¸¡ íŒŒì¼ íŠ¸ë¦¬ -->
        <div class="sidebar">
            <div class="upload-area">
                <div class="upload-zone" id="uploadZone">
                    <div style="font-size: 24px; margin-bottom: 10px;">ğŸ“</div>
                    <div>íŒŒì¼ì´ë‚˜ í´ë”ë¥¼ ì—¬ê¸°ì— ëŒì–´ë†“ìœ¼ì„¸ìš”</div>
                    <div style="font-size: 12px; margin-top: 5px; color: #999;">
                        ë˜ëŠ” ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”
                    </div>
                </div>
                <div class="upload-buttons">
                    <button class="upload-btn" onclick="selectFiles()">ğŸ“„ íŒŒì¼ ì„ íƒ</button>
                    <button class="upload-btn" onclick="selectFolder()">ğŸ“ í´ë” ì„ íƒ</button>
                    <button class="upload-btn" onclick="clearAll()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
                </div>
            </div>
            <div class="file-tree" id="fileTree">
                <div class="empty-state">
                    <h3>íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</h3>
                    <p>ì§€ì› ì–¸ì–´: JavaScript, TypeScript, Python, CSS, HTML, JSON</p>
                </div>
            </div>
        </div>

        <!-- ìš°ì¸¡ ì½”ë“œ ë·°ì–´ -->
        <div class="main-content">
            <div class="toolbar">
                <div class="file-info" id="fileInfo">íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”</div>
                <button class="toolbar-btn" onclick="expandAll()">ëª¨ë‘ í¼ì¹˜ê¸°</button>
                <button class="toolbar-btn" onclick="collapseAll()">ëª¨ë‘ ì ‘ê¸°</button>
                <button class="toolbar-btn" onclick="exportBlocks()">ë¸”ë¡ ë‚´ë³´ë‚´ê¸°</button>
            </div>
            <div class="code-viewer" id="codeViewer">
                <div class="empty-state">
                    <h3>ğŸš€ ì½”ë“œ ë¸”ë¡ ë·°ì–´</h3>
                    <p>ì¢Œì¸¡ì—ì„œ íŒŒì¼ì„ ì„ íƒí•˜ë©´ ì½”ë“œê°€ ë¸”ë¡ë³„ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</p>
                    <br>
                    <p>âœ¨ <strong>ê¸°ëŠ¥:</strong></p>
                    <p>â€¢ í•¨ìˆ˜, í´ë˜ìŠ¤ë³„ë¡œ ë¸”ë¡ êµ¬ë¶„</p>
                    <p>â€¢ ë¸”ë¡ ì ‘ê¸°/í¼ì¹˜ê¸°</p>
                    <p>â€¢ ì½”ë“œ í•˜ì´ë¼ì´íŒ…</p>
                    <p>â€¢ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì§€ì›</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ìˆ¨ê²¨ì§„ input ìš”ì†Œë“¤ -->
    <input type="file" id="fileInput" multiple accept=".js,.jsx,.ts,.tsx,.py,.css,.html,.json,.vue,.php,.java,.cs,.cpp,.c" style="display: none;">
    <input type="file" id="folderInput" webkitdirectory style="display: none;">

    <script>
        let fileData = new Map(); // íŒŒì¼ ë°ì´í„° ì €ì¥
        let currentFile = null;   // í˜„ì¬ ì„ íƒëœ íŒŒì¼

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì„¤ì •
        const uploadZone = document.getElementById('uploadZone');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadZone.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadZone.addEventListener(eventName, () => {
                uploadZone.classList.add('dragover');
            });
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadZone.addEventListener(eventName, () => {
                uploadZone.classList.remove('dragover');
            });
        });

        uploadZone.addEventListener('drop', handleDrop);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(Array.from(files));
        }

        // íŒŒì¼ ì„ íƒ í•¨ìˆ˜ë“¤
        function selectFiles() {
            document.getElementById('fileInput').click();
        }

        function selectFolder() {
            document.getElementById('folderInput').click();
        }

        document.getElementById('fileInput').addEventListener('change', function(e) {
            handleFiles(Array.from(e.target.files));
        });

        document.getElementById('folderInput').addEventListener('change', function(e) {
            handleFiles(Array.from(e.target.files));
        });

        // íŒŒì¼ ì²˜ë¦¬
        async function handleFiles(files) {
            const supportedExts = ['.js', '.jsx', '.ts', '.tsx', '.py', '.css', '.html', '.json', '.vue', '.php', '.java', '.cs', '.cpp', '.c'];
            const validFiles = files.filter(file => {
                const ext = '.' + file.name.split('.').pop().toLowerCase();
                return supportedExts.includes(ext);
            });

            if (validFiles.length === 0) {
                alert('ì§€ì›ë˜ëŠ” íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.\nì§€ì› í˜•ì‹: ' + supportedExts.join(', '));
                return;
            }

            document.getElementById('fileTree').innerHTML = '<div class="loading">íŒŒì¼ì„ ì½ëŠ” ì¤‘...</div>';

            for (const file of validFiles) {
                try {
                    const content = await readFileContent(file);
                    const filePath = file.webkitRelativePath || file.name;
                    fileData.set(filePath, {
                        name: file.name,
                        path: filePath,
                        content: content,
                        size: file.size,
                        lastModified: file.lastModified
                    });
                } catch (error) {
                    console.error('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨:', file.name, error);
                }
            }

            renderFileTree();
        }

        function readFileContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsText(file, 'UTF-8');
            });
        }

        // íŒŒì¼ íŠ¸ë¦¬ ë Œë”ë§
        function renderFileTree() {
            const fileTree = document.getElementById('fileTree');
            const files = Array.from(fileData.keys()).sort();
            
            if (files.length === 0) {
                fileTree.innerHTML = '<div class="empty-state"><h3>íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</h3></div>';
                return;
            }

            const tree = buildFileTree(files);
            fileTree.innerHTML = renderTreeHTML(tree);
        }

        function buildFileTree(filePaths) {
            const tree = {};
            
            filePaths.forEach(path => {
                const parts = path.split('/');
                let current = tree;
                
                parts.forEach((part, index) => {
                    if (!current[part]) {
                        current[part] = index === parts.length - 1 ? { 
                            type: 'file', 
                            path: path 
                        } : { 
                            type: 'folder', 
                            children: {} 
                        };
                    }
                    if (current[part].children) {
                        current = current[part].children;
                    }
                });
            });

            return tree;
        }

        function renderTreeHTML(tree, level = 0) {
            let html = '';
            
            Object.entries(tree).forEach(([name, node]) => {
                if (node.type === 'file') {
                    const file = fileData.get(node.path);
                    const size = formatFileSize(file.size);
                    html += `<div class="tree-item file" onclick="selectFile('${node.path}')" title="${node.path} (${size})">${name}</div>`;
                } else {
                    html += `<div class="tree-item folder" onclick="toggleFolder(this)">${name}</div>`;
                    html += `<div style="margin-left: 20px;">${renderTreeHTML(node.children, level + 1)}</div>`;
                }
            });

            return html;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function toggleFolder(element) {
            element.classList.toggle('expanded');
            const next = element.nextElementSibling;
            if (next) {
                next.style.display = next.style.display === 'none' ? 'block' : 'none';
            }
        }

        // íŒŒì¼ ì„ íƒ
        function selectFile(filePath) {
            // ì´ì „ ì„ íƒ í•´ì œ
            document.querySelectorAll('.tree-item.active').forEach(item => {
                item.classList.remove('active');
            });

            // ìƒˆ ì„ íƒ í‘œì‹œ
            const fileItem = document.querySelector(`[onclick="selectFile('${filePath}')"]`);
            if (fileItem) {
                fileItem.classList.add('active');
            }

            currentFile = filePath;
            const file = fileData.get(filePath);
            
            if (file) {
                document.getElementById('fileInfo').textContent = 
                    `${file.name} (${formatFileSize(file.size)}) - ${countLines(file.content)} ì¤„`;
                renderCodeBlocks(file.content, file.name);
            }
        }

        function countLines(content) {
            return content.split('\n').length;
        }

        // ì½”ë“œ ë¸”ë¡ íŒŒì‹± ë° ë Œë”ë§
        function renderCodeBlocks(content, filename) {
            const codeViewer = document.getElementById('codeViewer');
            const ext = '.' + filename.split('.').pop().toLowerCase();
            const blocks = parseCodeBlocks(content, ext);

            if (blocks.length === 0) {
                codeViewer.innerHTML = '<div class="empty-state"><h3>ì½”ë“œ ë¸”ë¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3><p>ì „ì²´ ì½”ë“œë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.</p></div>';
                return;
            }

            let html = '';
            blocks.forEach((block, index) => {
                const previewLine = block.content.split('\n')[0].trim().substring(0, 80) + '...';
                
                html += `
                <div class="code-block" id="block-${index}">
                    <div class="block-header" onclick="toggleBlock(${index})">
                        <div>
                            <div class="block-title">${escapeHtml(block.title)}</div>
                            <div class="block-info">${block.startLine}-${block.endLine}ì¤„ (${block.endLine - block.startLine + 1}ì¤„)</div>
                        </div>
                        <div class="block-toggle">â–¼</div>
                    </div>
                    <div class="block-preview">${escapeHtml(previewLine)}</div>
                    <div class="block-content">
                        <pre><code>${highlightCode(block.content, ext)}</code></pre>
                    </div>
                </div>
                `;
            });

            codeViewer.innerHTML = html;
        }

        function parseCodeBlocks(content, fileExt) {
            const lines = content.split('\n');
            const blocks = [];

            if (fileExt === '.js' || fileExt === '.jsx' || fileExt === '.ts' || fileExt === '.tsx') {
                return parseJavaScriptBlocks(lines);
            } else if (fileExt === '.py') {
                return parsePythonBlocks(lines);
            } else if (fileExt === '.css') {
                return parseCSSBlocks(lines);
            } else if (fileExt === '.json') {
                return parseJSONBlocks(lines);
            } else {
                // ê¸°íƒ€ íŒŒì¼ë“¤ì€ ë‹¨ìˆœí•˜ê²Œ í•¨ìˆ˜ë³„ë¡œ íŒŒì‹±
                return parseGenericBlocks(lines);
            }
        }

        function parseJavaScriptBlocks(lines) {
            const blocks = [];
            let i = 0;
            
            while (i < lines.length) {
                const line = lines[i].trim();
                
                // í•¨ìˆ˜ ê²€ìƒ‰
                if (line.match(/^(function\s+\w+|const\s+\w+\s*=\s*(?:async\s*)?\(|class\s+\w+|export\s+(?:default\s+)?(?:function|class)\s+\w+)/)) {
                    const block = extractBlock(lines, i, line);
                    if (block) {
                        blocks.push(block);
                        i = block.endLine;
                    }
                } else if (line.match(/^\w+\s*:\s*(?:async\s*)?\(|^\w+\s*\(/)) {
                    // ê°ì²´ ë©”ì„œë“œë‚˜ í•¨ìˆ˜ í˜¸ì¶œ
                    const block = extractBlock(lines, i, line);
                    if (block) {
                        blocks.push(block);
                        i = block.endLine;
                    }
                }
                i++;
            }
            
            return blocks;
        }

        function parsePythonBlocks(lines) {
            const blocks = [];
            let i = 0;
            
            while (i < lines.length) {
                const line = lines[i].trim();
                
                // í•¨ìˆ˜ë‚˜ í´ë˜ìŠ¤ ê²€ìƒ‰
                if (line.match(/^(def\s+\w+|class\s+\w+)/)) {
                    const block = extractPythonBlock(lines, i, line);
                    if (block) {
                        blocks.push(block);
                        i = block.endLine;
                    }
                }
                i++;
            }
            
            return blocks;
        }

        function parseCSSBlocks(lines) {
            const blocks = [];
            let i = 0;
            
            while (i < lines.length) {
                const line = lines[i].trim();
                
                // CSS ì„ íƒì ê²€ìƒ‰
                if (line.match(/^[.#]?[\w-]+.*\{/) || line.match(/^@\w+/)) {
                    const block = extractCSSBlock(lines, i, line);
                    if (block) {
                        blocks.push(block);
                        i = block.endLine;
                    }
                }
                i++;
            }
            
            return blocks;
        }

        function parseJSONBlocks(lines) {
            const blocks = [];
            let i = 0;
            let depth = 0;
            
            while (i < lines.length) {
                const line = lines[i].trim();
                
                if (line.includes('{') || line.includes('[')) {
                    const startLine = i + 1;
                    const startContent = line;
                    let content = line + '\n';
                    depth = (line.match(/\{/g) || []).length - (line.match(/\}/g) || []).length;
                    depth += (line.match(/\[/g) || []).length - (line.match(/\]/g) || []).length;
                    i++;
                    
                    while (i < lines.length && depth > 0) {
                        const currentLine = lines[i];
                        content += currentLine + '\n';
                        depth += (currentLine.match(/\{/g) || []).length - (currentLine.match(/\}/g) || []).length;
                        depth += (currentLine.match(/\[/g) || []).length - (currentLine.match(/\]/g) || []).length;
                        i++;
                    }
                    
                    if (content.trim()) {
                        blocks.push({
                            title: `JSON ë¸”ë¡ (${startContent.length > 30 ? startContent.substring(0, 30) + '...' : startContent})`,
                            content: content.trim(),
                            startLine: startLine,
                            endLine: i
                        });
                    }
                } else {
                    i++;
                }
            }
            
            return blocks;
        }

        function parseGenericBlocks(lines) {
            const blocks = [];
            let i = 0;
            
            while (i < lines.length) {
                const line = lines[i].trim();
                
                // ê°„ë‹¨í•œ í•¨ìˆ˜ë‚˜ ë©”ì„œë“œ íŒ¨í„´ ê²€ìƒ‰
                if (line.match(/^\w+.*\{/) && !line.includes(';')) {
                    const block = extractBlock(lines, i, line);
                    if (block) {
                        blocks.push(block);
                        i = block.endLine;
                    }
                }
                i++;
            }
            
            return blocks;
        }

        function extractBlock(lines, startIndex, startLine) {
            let braceCount = 0;
            let content = '';
            let i = startIndex;
            let foundOpenBrace = false;
            
            while (i < lines.length) {
                const line = lines[i];
                content += line + '\n';
                
                const openBraces = (line.match(/\{/g) || []).length;
                const closeBraces = (line.match(/\}/g) || []).length;
                
                braceCount += openBraces - closeBraces;
                
                if (openBraces > 0) foundOpenBrace = true;
                
                if (foundOpenBrace && braceCount === 0) {
                    return {
                        title: extractTitle(startLine),
                        content: content.trim(),
                        startLine: startIndex + 1,
                        endLine: i + 1
                    };
                }
                
                i++;
            }
            
            return null;
        }

        function extractPythonBlock(lines, startIndex, startLine) {
            let content = lines[startIndex] + '\n';
            let i = startIndex + 1;
            let baseIndent = lines[startIndex].search(/\S/);
            
            while (i < lines.length) {
                const line = lines[i];
                const lineIndent = line.search(/\S/);
                
                if (line.trim() === '') {
                    content += line + '\n';
                    i++;
                    continue;
                }
                
                if (lineIndent <= baseIndent && line.trim() !== '') {
                    break;
                }
                
                content += line + '\n';
                i++;
            }
            
            return {
                title: extractTitle(startLine),
                content: content.trim(),
                startLine: startIndex + 1,
                endLine: i
            };
        }

        function extractCSSBlock(lines, startIndex, startLine) {
            let braceCount = 0;
            let content = '';
            let i = startIndex;
            
            while (i < lines.length) {
                const line = lines[i];
                content += line + '\n';
                
                braceCount += (line.match(/\{/g) || []).length;
                braceCount -= (line.match(/\}/g) || []).length;
                
                if (braceCount === 0 && content.includes('{')) {
                    return {
                        title: extractTitle(startLine),
                        content: content.trim(),
                        startLine: startIndex + 1,
                        endLine: i + 1
                    };
                }
                
                i++;
            }
            
            return null;
        }

        function extractTitle(line) {
            // í•¨ìˆ˜ëª…ì´ë‚˜ í´ë˜ìŠ¤ëª… ì¶”ì¶œ
            const patterns = [
                /function\s+(\w+)/,
                /const\s+(\w+)\s*=/,
                /class\s+(\w+)/,
                /def\s+(\w+)/,
                /(\w+)\s*:\s*\(/,
                /^([.#]?[\w-]+)/
            ];
            
            for (const pattern of patterns) {
                const match = line.match(pattern);
                if (match) {
                    return match[1];
                }
            }
            
            return line.length > 50 ? line.substring(0, 50) + '...' : line;
        }

        // ë¸”ë¡ í† ê¸€
        function toggleBlock(index) {
            const block = document.getElementById(`block-${index}`);
            const content = block.querySelector('.block-content');
            const toggle = block.querySelector('.block-toggle');
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                toggle.classList.remove('collapsed');
                block.classList.remove('collapsed');
            } else {
                content.classList.add('collapsed');
                toggle.classList.add('collapsed');
                block.classList.add('collapsed');
            }
        }

        // ëª¨ë“  ë¸”ë¡ ì œì–´
        function expandAll() {
            document.querySelectorAll('.block-content').forEach(content => {
                content.classList.remove('collapsed');
            });
            document.querySelectorAll('.block-toggle').forEach(toggle => {
                toggle.classList.remove('collapsed');
            });
            document.querySelectorAll('.code-block').forEach(block => {
                block.classList.remove('collapsed');
            });
        }

        function collapseAll() {
            document.querySelectorAll('.block-content').forEach(content => {
                content.classList.add('collapsed');
            });
            document.querySelectorAll('.block-toggle').forEach(toggle => {
                toggle.classList.add('collapsed');
            });
            document.querySelectorAll('.code-block').forEach(block => {
                block.classList.add('collapsed');
            });
        }

        // ë¸”ë¡ ë‚´ë³´ë‚´ê¸°
        function exportBlocks() {
            if (!currentFile) {
                alert('ë¨¼ì € íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const file = fileData.get(currentFile);
            const blocks = parseCodeBlocks(file.content, '.' + file.name.split('.').pop().toLowerCase());
            
            const exportData = {
                filename: file.name,
                blocks: blocks.map(block => ({
                    title: block.title,
                    lines: `${block.startLine}-${block.endLine}`,
                    content: block.content
                }))
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${file.name}_blocks.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ì´ˆê¸°í™”
        function clearAll() {
            fileData.clear();
            currentFile = null;
            renderFileTree();
            document.getElementById('fileInfo').textContent = 'íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”';
            document.getElementById('codeViewer').innerHTML = `
                <div class="empty-state">
                    <h3>ğŸš€ ì½”ë“œ ë¸”ë¡ ë·°ì–´</h3>
                    <p>ì¢Œì¸¡ì—ì„œ íŒŒì¼ì„ ì„ íƒí•˜ë©´ ì½”ë“œê°€ ë¸”ë¡ë³„ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</p>
                </div>
            `;
        }

        // ë¬¸ë²• í•˜ì´ë¼ì´íŒ… (ê°„ë‹¨í•œ ë²„ì „)
        function highlightCode(code, ext) {
            let highlighted = escapeHtml(code);

            if (ext === '.js' || ext === '.jsx' || ext === '.ts' || ext === '.tsx') {
                // JavaScript/TypeScript í‚¤ì›Œë“œ
                const keywords = ['function', 'const', 'let', 'var', 'class', 'if', 'else', 'for', 'while', 'return', 'import', 'export', 'default', 'async', 'await', 'try', 'catch', 'finally'];
                keywords.forEach(keyword => {
                    const regex = new RegExp(`\\b(${keyword})\\b`, 'g');
                    highlighted = highlighted.replace(regex, '<span class="keyword">$1</span>');
                });
            } else if (ext === '.py') {
                // Python í‚¤ì›Œë“œ
                const keywords = ['def', 'class', 'if', 'elif', 'else', 'for', 'while', 'return', 'import', 'from', 'try', 'except', 'finally', 'with', 'as'];
                keywords.forEach(keyword => {
                    const regex = new RegExp(`\\b(${keyword})\\b`, 'g');
                    highlighted = highlighted.replace(regex, '<span class="keyword">$1</span>');
                });
            }

            // ë¬¸ìì—´
            highlighted = highlighted.replace(/(['"`])((?:\\.|(?!\1)[^\\])*?)\1/g, '<span class="string">$1$2$1</span>');
            
            // ì£¼ì„
            highlighted = highlighted.replace(/(\/\/.*$|\/\*[\s\S]*?\*\/|#.*$)/gm, '<span class="comment">$1</span>');
            
            // ìˆ«ì
            highlighted = highlighted.replace(/\b(\d+\.?\d*)\b/g, '<span class="number">$1</span>');
            
            // ê´„í˜¸
            highlighted = highlighted.replace(/([{}[\]()])/g, '<span class="bracket">$1</span>');

            return highlighted;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“¦ ì½”ë“œ ë¸”ë¡ ë·°ì–´ ì¤€ë¹„ ì™„ë£Œ!');
        });
    </script>
</body>
</html>