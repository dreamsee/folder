<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“¦ ì½”ë“œ ë¸”ë¡ ë·°ì–´ v2 (ìˆ˜ì •) - ì„¹ì…˜ ë„¤ë¹„ê²Œì´ì…˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Consolas', 'Monaco', 'JetBrains Mono', monospace;
            background: #0d1117;
            color: #f0f6fc;
            height: 100vh;
            overflow: hidden;
        }

        /* í—¤ë” */
        .header {
            background: linear-gradient(135deg, #1e2328 0%, #2d333b 100%);
            padding: 20px;
            border-bottom: 1px solid #30363d;
        }

        .header h1 {
            color: #58a6ff;
            font-size: 24px;
            margin-bottom: 8px;
        }

        .header p {
            color: #8b949e;
            font-size: 14px;
        }

        /* ì—…ë¡œë“œ ì˜ì—­ */
        .upload-section {
            background: #161b22;
            padding: 15px 20px;
            border-bottom: 1px solid #30363d;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .upload-zone {
            flex: 1;
            border: 2px dashed #30363d;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #0d1117;
        }

        .upload-zone:hover,
        .upload-zone.dragover {
            border-color: #58a6ff;
            background: #0c2d6b;
        }

        .upload-buttons {
            display: flex;
            gap: 10px;
        }

        .upload-btn {
            padding: 8px 16px;
            background: #238636;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
            font-family: inherit;
        }

        .upload-btn:hover {
            background: #2ea043;
        }

        .upload-btn.secondary {
            background: #21262d;
            color: #f0f6fc;
        }

        .upload-btn.secondary:hover {
            background: #30363d;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .main-container {
            display: flex;
            height: calc(100vh - 140px);
        }

        /* íŒŒì¼ íŠ¸ë¦¬ (ì¢Œì¸¡ ì²« ë²ˆì§¸) */
        .file-sidebar {
            width: 280px;
            background: #0d1117;
            border-right: 1px solid #30363d;
            overflow-y: auto;
            resize: horizontal;
            min-width: 200px;
            max-width: 400px;
        }

        .file-tree {
            padding: 15px;
        }

        .tree-item {
            padding: 6px 12px;
            cursor: pointer;
            border-radius: 6px;
            margin: 2px 0;
            user-select: none;
            font-size: 13px;
            transition: background 0.2s;
        }

        .tree-item:hover {
            background: #21262d;
        }

        .tree-item.active {
            background: #1f6feb;
            color: #ffffff;
        }

        .tree-item.folder {
            font-weight: 600;
            color: #58a6ff;
        }

        .tree-item.file {
            padding-left: 24px;
            color: #e6edf3;
        }

        .tree-item.file::before {
            content: "ğŸ“„ ";
            margin-right: 6px;
        }

        .tree-item.folder::before {
            content: "ğŸ“ ";
            margin-right: 6px;
        }

        .tree-item.folder.expanded::before {
            content: "ğŸ“‚ ";
        }

        /* ì„¹ì…˜ ë„¤ë¹„ê²Œì´ì…˜ (ì¢Œì¸¡ ë‘ ë²ˆì§¸) */
        .section-nav {
            width: 300px;
            background: #161b22;
            border-right: 1px solid #30363d;
            overflow-y: auto;
            resize: horizontal;
            min-width: 250px;
            max-width: 450px;
        }

        .nav-header {
            padding: 20px;
            border-bottom: 1px solid #30363d;
            background: #21262d;
        }

        .nav-title {
            color: #58a6ff;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .nav-subtitle {
            color: #8b949e;
            font-size: 12px;
        }

        .nav-list {
            list-style: none;
            padding: 15px;
        }

        .nav-item {
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 6px;
            margin: 3px 0;
            user-select: none;
            font-size: 13px;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            position: relative;
        }

        .nav-item:hover {
            background: #21262d;
            border-left-color: #30363d;
        }

        .nav-item.active {
            background: #0d419d;
            border-left-color: #58a6ff;
            color: #ffffff;
        }

        .nav-item .section-title {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .nav-item .section-info {
            font-size: 11px;
            color: #8b949e;
        }

        .nav-item.active .section-info {
            color: #cae8ff;
        }

        .nav-item .block-count {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: #30363d;
            color: #f0f6fc;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 500;
        }

        .nav-item.active .block-count {
            background: #388bfd;
        }

        /* ì½”ë“œ ë·°ì–´ (ìš°ì¸¡) */
        .code-viewer {
            flex: 1;
            background: #0d1117;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .viewer-header {
            background: #161b22;
            padding: 15px 20px;
            border-bottom: 1px solid #30363d;
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .current-section {
            flex: 1;
        }

        .section-name {
            color: #58a6ff;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .section-details {
            color: #8b949e;
            font-size: 12px;
        }

        .viewer-controls {
            display: flex;
            gap: 8px;
        }

        .viewer-btn {
            padding: 6px 12px;
            background: #21262d;
            color: #f0f6fc;
            border: 1px solid #30363d;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s;
            font-family: inherit;
        }

        .viewer-btn:hover {
            background: #30363d;
            border-color: #40464f;
        }

        .viewer-content {
            flex: 1;
            padding: 20px;
        }

        /* ì½”ë“œ ë¸”ë¡ */
        .code-block {
            margin-bottom: 20px;
            border: 1px solid #30363d;
            border-radius: 8px;
            background: #161b22;
            overflow: hidden;
        }

        .block-header {
            background: #21262d;
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #30363d;
            user-select: none;
        }

        .block-header:hover {
            background: #30363d;
        }

        .block-title-section {
            flex: 1;
        }

        .block-title {
            font-weight: 600;
            color: #58a6ff;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .block-signature {
            font-size: 12px;
            color: #8b949e;
            font-family: 'Consolas', monospace;
        }

        .block-meta {
            text-align: right;
        }

        .block-lines {
            font-size: 11px;
            color: #8b949e;
            margin-bottom: 2px;
        }

        .block-type {
            font-size: 10px;
            color: #79c0ff;
            background: #0c2d6b;
            padding: 2px 6px;
            border-radius: 3px;
        }

        .block-toggle {
            color: #8b949e;
            font-size: 12px;
            margin-left: 10px;
            transition: transform 0.2s;
        }

        .block-toggle.collapsed {
            transform: rotate(-90deg);
        }

        .block-content {
            background: #0d1117;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .block-content.collapsed {
            height: 0;
        }

        .block-preview {
            padding: 12px 16px;
            color: #8b949e;
            font-size: 12px;
            background: #161b22;
            border-top: 1px solid #21262d;
            display: none;
        }

        .code-block.collapsed .block-preview {
            display: block;
        }

        .code-content {
            padding: 16px;
        }

        pre {
            margin: 0;
            padding: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Consolas', 'Monaco', 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.5;
            color: #e6edf3;
        }

        /* ë¬¸ë²• í•˜ì´ë¼ì´íŒ… */
        .keyword { color: #ff7b72; font-weight: 600; }
        .string { color: #a5d6ff; }
        .comment { color: #8b949e; font-style: italic; }
        .number { color: #79c0ff; }
        .function { color: #d2a8ff; }
        .class { color: #7ee787; }
        .variable { color: #ffa657; }
        .operator { color: #f85149; }
        .bracket { color: #f0f6fc; }
        .property { color: #79c0ff; }

        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #8b949e;
        }

        .empty-state h3 {
            color: #58a6ff;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .empty-state p {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        /* ìŠ¤í¬ë¡¤ë°” */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #161b22;
        }

        ::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #484f58;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 1200px) {
            .file-sidebar {
                width: 250px;
            }
            .section-nav {
                width: 280px;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .file-sidebar,
            .section-nav {
                width: 100%;
                height: 150px;
                resize: none;
            }
            
            .upload-section {
                flex-direction: column;
                gap: 10px;
            }
            
            .upload-zone {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <h1>ğŸ“¦ ì½”ë“œ ë¸”ë¡ ë·°ì–´ v2 (ìˆ˜ì •)</h1>
        <p>ì„¹ì…˜ ë„¤ë¹„ê²Œì´ì…˜ìœ¼ë¡œ ì½”ë“œë¥¼ ë” ì²´ê³„ì ìœ¼ë¡œ íƒìƒ‰í•˜ì„¸ìš”</p>
    </header>

    <!-- ì—…ë¡œë“œ ì„¹ì…˜ -->
    <div class="upload-section">
        <div class="upload-zone" id="uploadZone">
            <div style="font-size: 16px; margin-bottom: 5px;">ğŸ¯ íŒŒì¼ì´ë‚˜ í´ë”ë¥¼ ëŒì–´ë†“ìœ¼ì„¸ìš”</div>
            <div style="font-size: 11px; color: #8b949e;">JavaScript, TypeScript, Python, CSS, HTML, JSON ì§€ì›</div>
        </div>
        <div class="upload-buttons">
            <button class="upload-btn" onclick="selectFiles()">ğŸ“„ íŒŒì¼ ì„ íƒ</button>
            <button class="upload-btn" onclick="selectFolder()">ğŸ“ í´ë” ì„ íƒ</button>
            <button class="upload-btn secondary" onclick="clearAll()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="main-container">
        <!-- íŒŒì¼ íŠ¸ë¦¬ -->
        <div class="file-sidebar">
            <div class="file-tree" id="fileTree">
                <div class="empty-state">
                    <h3>ğŸ“ íŒŒì¼ íŠ¸ë¦¬</h3>
                    <p>íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´<br>ì—¬ê¸°ì— íŒŒì¼ ëª©ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤</p>
                </div>
            </div>
        </div>

        <!-- ì„¹ì…˜ ë„¤ë¹„ê²Œì´ì…˜ -->
        <nav class="section-nav">
            <div class="nav-header">
                <div class="nav-title">ì½”ë“œ ì„¹ì…˜</div>
                <div class="nav-subtitle">ë¸”ë¡ì„ ì¢…ë¥˜ë³„ë¡œ ë¶„ë¥˜</div>
            </div>
            <ul class="nav-list" id="sectionNav">
                <div class="empty-state">
                    <h3>ğŸ¯ ì„¹ì…˜ ëª©ë¡</h3>
                    <p>íŒŒì¼ì„ ì„ íƒí•˜ë©´<br>ì½”ë“œ ì„¹ì…˜ì´ í‘œì‹œë©ë‹ˆë‹¤</p>
                </div>
            </ul>
        </nav>

        <!-- ì½”ë“œ ë·°ì–´ -->
        <div class="code-viewer">
            <div class="viewer-header">
                <div class="current-section">
                    <div class="section-name" id="currentSectionName">ì„¹ì…˜ì„ ì„ íƒí•˜ì„¸ìš”</div>
                    <div class="section-details" id="currentSectionDetails">ì¢Œì¸¡ì—ì„œ ì„¹ì…˜ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ ì½”ë“œ ë¸”ë¡ë“¤ì´ í‘œì‹œë©ë‹ˆë‹¤</div>
                </div>
                <div class="viewer-controls">
                    <button class="viewer-btn" onclick="expandAllBlocks()">ëª¨ë‘ í¼ì¹˜ê¸°</button>
                    <button class="viewer-btn" onclick="collapseAllBlocks()">ëª¨ë‘ ì ‘ê¸°</button>
                    <button class="viewer-btn" onclick="exportCurrentSection()">ë‚´ë³´ë‚´ê¸°</button>
                </div>
            </div>
            <div class="viewer-content" id="viewerContent">
                <div class="empty-state">
                    <h3>ğŸš€ ì½”ë“œ ë¸”ë¡ ë·°ì–´ v2 (ìˆ˜ì •)</h3>
                    <p>âœ¨ <strong>ìˆ˜ì •ëœ ê¸°ëŠ¥:</strong></p>
                    <p>â€¢ ë” ì •í™•í•œ {} ê´„í˜¸ ë‹¨ìœ„ ì¸ì‹</p>
                    <p>â€¢ í–¥ìƒëœ í•¨ìˆ˜/í´ë˜ìŠ¤ íŒŒì‹±</p>
                    <p>â€¢ ì¤‘ë³µ ì œëª© ë¬¸ì œ í•´ê²°</p>
                    <p>â€¢ ì„¹ì…˜ë³„ ì²´ê³„ì  ë¶„ë¥˜</p>
                    <br>
                    <p>íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ìˆ¨ê²¨ì§„ ì…ë ¥ ìš”ì†Œë“¤ -->
    <input type="file" id="fileInput" multiple accept=".js,.jsx,.ts,.tsx,.py,.css,.html,.json,.vue,.php,.java,.cs,.cpp,.c" style="display: none;">
    <input type="file" id="folderInput" webkitdirectory style="display: none;">

    <script>
        // ì „ì—­ ë³€ìˆ˜ë“¤
        let fileData = new Map();
        let currentFile = null;
        let currentSection = null;
        let parsedSections = new Map();

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì„¤ì • (v1ê³¼ ë™ì¼)
        const uploadZone = document.getElementById('uploadZone');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadZone.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadZone.addEventListener(eventName, () => {
                uploadZone.classList.add('dragover');
            });
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadZone.addEventListener(eventName, () => {
                uploadZone.classList.remove('dragover');
            });
        });

        uploadZone.addEventListener('drop', handleDrop);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(Array.from(files));
        }

        // íŒŒì¼ ì„ íƒ í•¨ìˆ˜ë“¤ (v1ê³¼ ë™ì¼)
        function selectFiles() {
            document.getElementById('fileInput').click();
        }

        function selectFolder() {
            document.getElementById('folderInput').click();
        }

        document.getElementById('fileInput').addEventListener('change', function(e) {
            handleFiles(Array.from(e.target.files));
        });

        document.getElementById('folderInput').addEventListener('change', function(e) {
            handleFiles(Array.from(e.target.files));
        });

        // íŒŒì¼ ì²˜ë¦¬ (v1ê³¼ ë™ì¼)
        async function handleFiles(files) {
            const supportedExts = ['.js', '.jsx', '.ts', '.tsx', '.py', '.css', '.html', '.json', '.vue', '.php', '.java', '.cs', '.cpp', '.c'];
            const validFiles = files.filter(file => {
                const ext = '.' + file.name.split('.').pop().toLowerCase();
                return supportedExts.includes(ext);
            });

            if (validFiles.length === 0) {
                alert('ì§€ì›ë˜ëŠ” íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.\nì§€ì› í˜•ì‹: ' + supportedExts.join(', '));
                return;
            }

            document.getElementById('fileTree').innerHTML = '<div class="empty-state"><h3>íŒŒì¼ ë¡œë”©ì¤‘...</h3></div>';

            for (const file of validFiles) {
                try {
                    const content = await readFileContent(file);
                    const filePath = file.webkitRelativePath || file.name;
                    fileData.set(filePath, {
                        name: file.name,
                        path: filePath,
                        content: content,
                        size: file.size,
                        lastModified: file.lastModified
                    });
                } catch (error) {
                    console.error('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨:', file.name, error);
                }
            }

            renderFileTree();
        }

        function readFileContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsText(file, 'UTF-8');
            });
        }

        // íŒŒì¼ íŠ¸ë¦¬ ë Œë”ë§ (v1ê³¼ ë™ì¼)
        function renderFileTree() {
            const fileTree = document.getElementById('fileTree');
            const files = Array.from(fileData.keys()).sort();
            
            if (files.length === 0) {
                fileTree.innerHTML = '<div class="empty-state"><h3>ğŸ“ íŒŒì¼ íŠ¸ë¦¬</h3><p>íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</p></div>';
                return;
            }

            const tree = buildFileTree(files);
            fileTree.innerHTML = renderTreeHTML(tree);
        }

        function buildFileTree(filePaths) {
            const tree = {};
            
            filePaths.forEach(path => {
                const parts = path.split('/');
                let current = tree;
                
                parts.forEach((part, index) => {
                    if (!current[part]) {
                        current[part] = index === parts.length - 1 ? { 
                            type: 'file', 
                            path: path 
                        } : { 
                            type: 'folder', 
                            children: {} 
                        };
                    }
                    if (current[part].children) {
                        current = current[part].children;
                    }
                });
            });

            return tree;
        }

        function renderTreeHTML(tree, level = 0) {
            let html = '';
            
            Object.entries(tree).forEach(([name, node]) => {
                if (node.type === 'file') {
                    const file = fileData.get(node.path);
                    const size = formatFileSize(file.size);
                    html += `<div class="tree-item file" onclick="selectFile('${node.path}')" title="${node.path} (${size})">${name}</div>`;
                } else {
                    html += `<div class="tree-item folder" onclick="toggleFolder(this)">${name}</div>`;
                    html += `<div style="margin-left: 20px;">${renderTreeHTML(node.children, level + 1)}</div>`;
                }
            });

            return html;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function toggleFolder(element) {
            element.classList.toggle('expanded');
            const next = element.nextElementSibling;
            if (next) {
                next.style.display = next.style.display === 'none' ? 'block' : 'none';
            }
        }

        // íŒŒì¼ ì„ íƒ ë° ì„¹ì…˜ íŒŒì‹± (v1 ê¸°ë°˜ìœ¼ë¡œ ìˆ˜ì •)
        function selectFile(filePath) {
            // ì´ì „ ì„ íƒ í•´ì œ
            document.querySelectorAll('.tree-item.active').forEach(item => {
                item.classList.remove('active');
            });

            // ìƒˆ ì„ íƒ í‘œì‹œ
            const fileItem = document.querySelector(`[onclick="selectFile('${filePath}')"]`);
            if (fileItem) {
                fileItem.classList.add('active');
            }

            currentFile = filePath;
            const file = fileData.get(filePath);
            
            if (file) {
                parseFileIntoSections(file);
            }
        }

        function parseFileIntoSections(file) {
            const ext = '.' + file.name.split('.').pop().toLowerCase();
            
            // v1ì˜ íŒŒì‹± ë¡œì§ ì‚¬ìš© (ë” ì •í™•í•¨)
            const blocks = parseCodeBlocksV1(file.content, ext);
            
            console.log('íŒŒì‹±ëœ ë¸”ë¡ ìˆ˜:', blocks.length);
            console.log('ë¸”ë¡ë“¤:', blocks);
            
            // ì„¹ì…˜ë³„ë¡œ ë¶„ë¥˜
            const sections = categorizeBlocks(blocks, ext);
            parsedSections.set(currentFile, sections);
            
            renderSectionNav(sections);
            
            // ì²« ë²ˆì§¸ ì„¹ì…˜ ìë™ ì„ íƒ
            if (sections.size > 0) {
                const firstSection = sections.keys().next().value;
                selectSection(firstSection);
            } else {
                // ì„¹ì…˜ì´ ì—†ìœ¼ë©´ ì „ì²´ í‘œì‹œ
                const allSection = new Map();
                allSection.set('all', {
                    title: 'ì „ì²´ ì½”ë“œ',
                    blocks: [{
                        contextualTitle: file.name,
                        signature: `ì „ì²´ íŒŒì¼ (${file.content.split('\n').length}ì¤„)`,
                        content: file.content,
                        startLine: 1,
                        endLine: file.content.split('\n').length,
                        type: 'file'
                    }],
                    icon: 'ğŸ“„'
                });
                parsedSections.set(currentFile, allSection);
                renderSectionNav(allSection);
                selectSection('all');
            }
        }

        // v1ì˜ ì •í™•í•œ íŒŒì‹± ë¡œì§ ì‚¬ìš©
        function parseCodeBlocksV1(content, fileExt) {
            const lines = content.split('\n');
            const blocks = [];

            if (fileExt === '.js' || fileExt === '.jsx' || fileExt === '.ts' || fileExt === '.tsx') {
                return parseJavaScriptBlocksV1(lines);
            } else if (fileExt === '.py') {
                return parsePythonBlocksV1(lines);
            } else if (fileExt === '.css') {
                return parseCSSBlocksV1(lines);
            } else if (fileExt === '.json') {
                return parseJSONBlocksV1(lines);
            } else {
                return parseGenericBlocksV1(lines);
            }
        }

        function parseJavaScriptBlocksV1(lines) {
            const blocks = [];
            let i = 0;
            
            while (i < lines.length) {
                const line = lines[i].trim();
                
                // í•¨ìˆ˜ ê²€ìƒ‰
                if (line.match(/^(function\s+\w+|const\s+\w+\s*=\s*(?:async\s*)?\(|class\s+\w+|export\s+(?:default\s+)?(?:function|class)\s+\w+)/)) {
                    const block = extractBlockV1(lines, i, line);
                    if (block) {
                        block.contextualTitle = generateContextualTitle(line, 'function');
                        block.signature = line.substring(0, 100);
                        block.type = determineBlockType(line);
                        blocks.push(block);
                        i = block.endLine;
                    }
                } else if (line.match(/^\w+\s*:\s*(?:async\s*)?\(|^\w+\s*\(/)) {
                    // ê°ì²´ ë©”ì„œë“œë‚˜ í•¨ìˆ˜ í˜¸ì¶œ
                    const block = extractBlockV1(lines, i, line);
                    if (block) {
                        block.contextualTitle = generateContextualTitle(line, 'method');
                        block.signature = line.substring(0, 100);
                        block.type = 'method';
                        blocks.push(block);
                        i = block.endLine;
                    }
                }
                i++;
            }
            
            return blocks;
        }

        function parsePythonBlocksV1(lines) {
            const blocks = [];
            let i = 0;
            
            while (i < lines.length) {
                const line = lines[i].trim();
                
                // í•¨ìˆ˜ë‚˜ í´ë˜ìŠ¤ ê²€ìƒ‰
                if (line.match(/^(def\s+\w+|class\s+\w+)/)) {
                    const block = extractPythonBlockV1(lines, i, line);
                    if (block) {
                        block.contextualTitle = generateContextualTitle(line, 'python');
                        block.signature = line.substring(0, 100);
                        block.type = line.startsWith('class') ? 'class' : 'function';
                        blocks.push(block);
                        i = block.endLine;
                    }
                }
                i++;
            }
            
            return blocks;
        }

        function parseCSSBlocksV1(lines) {
            const blocks = [];
            let i = 0;
            
            while (i < lines.length) {
                const line = lines[i].trim();
                
                // CSS ì„ íƒì ê²€ìƒ‰
                if (line.match(/^[.#]?[\w-]+.*\{/) || line.match(/^@\w+/) || line.includes('{')) {
                    const block = extractCSSBlockV1(lines, i, line);
                    if (block) {
                        block.contextualTitle = generateContextualTitle(line, 'css');
                        block.signature = line.replace(/\s*\{.*/, '').trim();
                        block.type = line.startsWith('@media') ? 'media' : (line.startsWith('@keyframes') ? 'keyframes' : 'selector');
                        blocks.push(block);
                        i = block.endLine;
                    }
                }
                i++;
            }
            
            return blocks;
        }

        function parseJSONBlocksV1(lines) {
            const blocks = [];
            let i = 0;
            let depth = 0;
            
            while (i < lines.length) {
                const line = lines[i].trim();
                
                if (line.includes('{') || line.includes('[')) {
                    const startLine = i + 1;
                    const startContent = line;
                    let content = line + '\n';
                    depth = (line.match(/\{/g) || []).length - (line.match(/\}/g) || []).length;
                    depth += (line.match(/\[/g) || []).length - (line.match(/\]/g) || []).length;
                    i++;
                    
                    while (i < lines.length && depth > 0) {
                        const currentLine = lines[i];
                        content += currentLine + '\n';
                        depth += (currentLine.match(/\{/g) || []).length - (currentLine.match(/\}/g) || []).length;
                        depth += (currentLine.match(/\[/g) || []).length - (currentLine.match(/\]/g) || []).length;
                        i++;
                    }
                    
                    if (content.trim()) {
                        blocks.push({
                            contextualTitle: generateContextualTitle(startContent, 'json'),
                            signature: startContent.length > 50 ? startContent.substring(0, 50) + '...' : startContent,
                            content: content.trim(),
                            startLine: startLine,
                            endLine: i,
                            type: 'object'
                        });
                    }
                } else {
                    i++;
                }
            }
            
            return blocks;
        }

        function parseGenericBlocksV1(lines) {
            const blocks = [];
            let i = 0;
            
            while (i < lines.length) {
                const line = lines[i].trim();
                
                // ê°„ë‹¨í•œ í•¨ìˆ˜ë‚˜ ë©”ì„œë“œ íŒ¨í„´ ê²€ìƒ‰
                if (line.match(/^\w+.*\{/) && !line.includes(';')) {
                    const block = extractBlockV1(lines, i, line);
                    if (block) {
                        block.contextualTitle = generateContextualTitle(line, 'generic');
                        block.signature = line;
                        block.type = 'generic';
                        blocks.push(block);
                        i = block.endLine;
                    }
                }
                i++;
            }
            
            return blocks;
        }

        // v1 ë¸”ë¡ ì¶”ì¶œ í•¨ìˆ˜ë“¤
        function extractBlockV1(lines, startIndex, startLine) {
            let braceCount = 0;
            let content = '';
            let i = startIndex;
            let foundOpenBrace = false;
            
            while (i < lines.length) {
                const line = lines[i];
                content += line + '\n';
                
                const openBraces = (line.match(/\{/g) || []).length;
                const closeBraces = (line.match(/\}/g) || []).length;
                
                braceCount += openBraces - closeBraces;
                
                if (openBraces > 0) foundOpenBrace = true;
                
                if (foundOpenBrace && braceCount === 0) {
                    return {
                        content: content.trim(),
                        startLine: startIndex + 1,
                        endLine: i + 1
                    };
                }
                
                i++;
            }
            
            return null;
        }

        function extractPythonBlockV1(lines, startIndex, startLine) {
            let content = lines[startIndex] + '\n';
            let i = startIndex + 1;
            let baseIndent = lines[startIndex].search(/\S/);
            
            while (i < lines.length) {
                const line = lines[i];
                const lineIndent = line.search(/\S/);
                
                if (line.trim() === '') {
                    content += line + '\n';
                    i++;
                    continue;
                }
                
                if (lineIndent <= baseIndent && line.trim() !== '') {
                    break;
                }
                
                content += line + '\n';
                i++;
            }
            
            return {
                content: content.trim(),
                startLine: startIndex + 1,
                endLine: i
            };
        }

        function extractCSSBlockV1(lines, startIndex, startLine) {
            let braceCount = 0;
            let content = '';
            let i = startIndex;
            
            while (i < lines.length) {
                const line = lines[i];
                content += line + '\n';
                
                braceCount += (line.match(/\{/g) || []).length;
                braceCount -= (line.match(/\}/g) || []).length;
                
                if (braceCount === 0 && content.includes('{')) {
                    return {
                        content: content.trim(),
                        startLine: startIndex + 1,
                        endLine: i + 1
                    };
                }
                
                i++;
            }
            
            return null;
        }

        // ì»¨í…ìŠ¤íŠ¸ë³„ ì œëª© ìƒì„± (ì¤‘ë³µ í•´ê²°)
        function generateContextualTitle(line, context) {
            const trimmed = line.trim();
            
            if (context === 'function') {
                // JavaScript í•¨ìˆ˜
                let match = trimmed.match(/function\s+(\w+)/);
                if (match) return `${match[1]}() (í•¨ìˆ˜)`;
                
                match = trimmed.match(/const\s+(\w+)\s*=/);
                if (match) return `${match[1]}() (í™”ì‚´í‘œ í•¨ìˆ˜)`;
                
                match = trimmed.match(/class\s+(\w+)/);
                if (match) return `${match[1]} (í´ë˜ìŠ¤)`;
                
                return trimmed.substring(0, 30) + '... (í•¨ìˆ˜)';
            }
            
            if (context === 'method') {
                const match = trimmed.match(/(\w+)\s*[:(/]/);
                if (match) return `${match[1]}() (ë©”ì„œë“œ)`;
                return trimmed.substring(0, 30) + '... (ë©”ì„œë“œ)';
            }
            
            if (context === 'python') {
                let match = trimmed.match(/def\s+(\w+)/);
                if (match) return `${match[1]}() (Python í•¨ìˆ˜)`;
                
                match = trimmed.match(/class\s+(\w+)/);
                if (match) return `${match[1]} (Python í´ë˜ìŠ¤)`;
                
                return trimmed.substring(0, 30) + '...';
            }
            
            if (context === 'css') {
                if (trimmed.startsWith('@media')) return `ë¯¸ë””ì–´ ì¿¼ë¦¬: ${trimmed.substring(0, 30)}`;
                if (trimmed.startsWith('@keyframes')) {
                    const match = trimmed.match(/@keyframes\s+(\w+)/);
                    return match ? `${match[1]} (í‚¤í”„ë ˆì„)` : 'í‚¤í”„ë ˆì„';
                }
                const selector = trimmed.replace(/\s*\{.*/, '').trim();
                return `${selector} (ì„ íƒì)`;
            }
            
            if (context === 'json') {
                const key = trimmed.replace(/[{[\s:].*/g, '').replace(/['"]/g, '');
                return key ? `${key} (JSON)` : 'JSON ë¸”ë¡';
            }
            
            return trimmed.substring(0, 50);
        }

        function determineBlockType(line) {
            if (line.includes('class')) return 'class';
            if (line.includes('function') || line.includes('=>')) return 'function';
            if (line.match(/^const\s+[A-Z]/)) return 'component'; // React component
            if (line.match(/^const\s+use[A-Z]/)) return 'hook'; // React hook
            return 'function';
        }

        function categorizeBlocks(blocks, ext) {
            const sections = new Map();
            
            if (ext === '.js' || ext === '.jsx' || ext === '.ts' || ext === '.tsx') {
                // JavaScript/TypeScript ì„¹ì…˜ ë¶„ë¥˜
                sections.set('functions', { 
                    title: 'ğŸ”§ í•¨ìˆ˜ (Functions)', 
                    blocks: blocks.filter(b => ['function', 'method'].includes(b.type)),
                    icon: 'ğŸ”§'
                });
                sections.set('classes', { 
                    title: 'ğŸ—ï¸ í´ë˜ìŠ¤ (Classes)', 
                    blocks: blocks.filter(b => b.type === 'class'),
                    icon: 'ğŸ—ï¸'
                });
                sections.set('components', { 
                    title: 'ğŸ§© ì»´í¬ë„ŒíŠ¸ (Components)', 
                    blocks: blocks.filter(b => b.type === 'component'),
                    icon: 'ğŸ§©'
                });
                sections.set('hooks', { 
                    title: 'ğŸ£ í›… (Hooks)', 
                    blocks: blocks.filter(b => b.type === 'hook'),
                    icon: 'ğŸ£'
                });
                sections.set('other', { 
                    title: 'ğŸ“„ ê¸°íƒ€ (Other)', 
                    blocks: blocks.filter(b => !['function', 'class', 'component', 'hook', 'method'].includes(b.type)),
                    icon: 'ğŸ“„'
                });
            } else if (ext === '.py') {
                // Python ì„¹ì…˜ ë¶„ë¥˜
                sections.set('classes', { 
                    title: 'ğŸ—ï¸ í´ë˜ìŠ¤ (Classes)', 
                    blocks: blocks.filter(b => b.type === 'class'),
                    icon: 'ğŸ—ï¸'
                });
                sections.set('functions', { 
                    title: 'ğŸ”§ í•¨ìˆ˜ (Functions)', 
                    blocks: blocks.filter(b => b.type === 'function'),
                    icon: 'ğŸ”§'
                });
            } else if (ext === '.css') {
                // CSS ì„¹ì…˜ ë¶„ë¥˜
                sections.set('selectors', { 
                    title: 'ğŸ¨ ì„ íƒì (Selectors)', 
                    blocks: blocks.filter(b => b.type === 'selector'),
                    icon: 'ğŸ¨'
                });
                sections.set('media', { 
                    title: 'ğŸ“± ë¯¸ë””ì–´ ì¿¼ë¦¬ (Media Queries)', 
                    blocks: blocks.filter(b => b.type === 'media'),
                    icon: 'ğŸ“±'
                });
                sections.set('keyframes', { 
                    title: 'ğŸ¬ í‚¤í”„ë ˆì„ (Keyframes)', 
                    blocks: blocks.filter(b => b.type === 'keyframes'),
                    icon: 'ğŸ¬'
                });
            } else {
                // ê¸°íƒ€ íŒŒì¼ë“¤
                sections.set('all', { 
                    title: 'ğŸ“„ ëª¨ë“  ë¸”ë¡ (All Blocks)', 
                    blocks: blocks,
                    icon: 'ğŸ“„'
                });
            }
            
            // ë¹ˆ ì„¹ì…˜ ì œê±°
            const nonEmptySections = new Map();
            sections.forEach((section, key) => {
                if (section.blocks.length > 0) {
                    nonEmptySections.set(key, section);
                }
            });
            
            return nonEmptySections;
        }

        // ì„¹ì…˜ ë„¤ë¹„ê²Œì´ì…˜ ë Œë”ë§
        function renderSectionNav(sections) {
            const nav = document.getElementById('sectionNav');
            let html = '';
            
            sections.forEach((section, key) => {
                html += `
                <li class="nav-item" onclick="selectSection('${key}')" data-section="${key}">
                    <div class="section-title">${section.title}</div>
                    <div class="section-info">${section.blocks.length}ê°œ ë¸”ë¡</div>
                    <div class="block-count">${section.blocks.length}</div>
                </li>
                `;
            });
            
            nav.innerHTML = html;
        }

        // ì„¹ì…˜ ì„ íƒ
        function selectSection(sectionKey) {
            // ì´ì „ ì„ íƒ í•´ì œ
            document.querySelectorAll('.nav-item.active').forEach(item => {
                item.classList.remove('active');
            });
            
            // ìƒˆ ì„ íƒ í‘œì‹œ
            const navItem = document.querySelector(`[data-section="${sectionKey}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }
            
            currentSection = sectionKey;
            const sections = parsedSections.get(currentFile);
            const section = sections.get(sectionKey);
            
            if (section) {
                renderSectionBlocks(section);
            }
        }

        function renderSectionBlocks(section) {
            const sectionName = document.getElementById('currentSectionName');
            const sectionDetails = document.getElementById('currentSectionDetails');
            const viewerContent = document.getElementById('viewerContent');
            
            sectionName.textContent = section.title;
            sectionDetails.textContent = `${section.blocks.length}ê°œì˜ ì½”ë“œ ë¸”ë¡`;
            
            if (section.blocks.length === 0) {
                viewerContent.innerHTML = '<div class="empty-state"><h3>ë¹ˆ ì„¹ì…˜</h3><p>ì´ ì„¹ì…˜ì—ëŠ” ì½”ë“œ ë¸”ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>';
                return;
            }
            
            let html = '';
            section.blocks.forEach((block, index) => {
                const preview = block.content.split('\n')[0].trim().substring(0, 100) + '...';
                const blockId = `${currentSection}-${index}`;
                
                html += `
                <div class="code-block" id="block-${blockId}">
                    <div class="block-header" onclick="toggleBlock('${blockId}')">
                        <div class="block-title-section">
                            <div class="block-title">${escapeHtml(block.contextualTitle || 'Unknown')}</div>
                            <div class="block-signature">${escapeHtml(block.signature || '')}</div>
                        </div>
                        <div class="block-meta">
                            <div class="block-lines">ì¤„ ${block.startLine}-${block.endLine}</div>
                            <div class="block-type">${getBlockTypeLabel(block.type)}</div>
                        </div>
                        <div class="block-toggle">â–¼</div>
                    </div>
                    <div class="block-preview">${escapeHtml(preview)}</div>
                    <div class="block-content">
                        <div class="code-content">
                            <pre><code>${highlightCode(block.content, getFileExtension())}</code></pre>
                        </div>
                    </div>
                </div>
                `;
            });
            
            viewerContent.innerHTML = html;
        }

        function getBlockTypeLabel(type) {
            const labels = {
                'function': 'í•¨ìˆ˜',
                'class': 'í´ë˜ìŠ¤',
                'component': 'ì»´í¬ë„ŒíŠ¸',
                'hook': 'í›…',
                'method': 'ë©”ì„œë“œ',
                'selector': 'ì„ íƒì',
                'media': 'ë¯¸ë””ì–´ì¿¼ë¦¬',
                'keyframes': 'í‚¤í”„ë ˆì„',
                'generic': 'ë¸”ë¡',
                'file': 'íŒŒì¼',
                'object': 'ê°ì²´'
            };
            return labels[type] || type;
        }

        function getFileExtension() {
            if (!currentFile) return '.js';
            return '.' + currentFile.split('.').pop().toLowerCase();
        }

        // ë¸”ë¡ í† ê¸€
        function toggleBlock(blockId) {
            const block = document.getElementById(`block-${blockId}`);
            const content = block.querySelector('.block-content');
            const toggle = block.querySelector('.block-toggle');
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                toggle.classList.remove('collapsed');
                block.classList.remove('collapsed');
            } else {
                content.classList.add('collapsed');
                toggle.classList.add('collapsed');
                block.classList.add('collapsed');
            }
        }

        // ì „ì²´ ë¸”ë¡ ì œì–´
        function expandAllBlocks() {
            document.querySelectorAll('.block-content').forEach(content => {
                content.classList.remove('collapsed');
            });
            document.querySelectorAll('.block-toggle').forEach(toggle => {
                toggle.classList.remove('collapsed');
            });
            document.querySelectorAll('.code-block').forEach(block => {
                block.classList.remove('collapsed');
            });
        }

        function collapseAllBlocks() {
            document.querySelectorAll('.block-content').forEach(content => {
                content.classList.add('collapsed');
            });
            document.querySelectorAll('.block-toggle').forEach(toggle => {
                toggle.classList.add('collapsed');
            });
            document.querySelectorAll('.code-block').forEach(block => {
                block.classList.add('collapsed');
            });
        }

        // í˜„ì¬ ì„¹ì…˜ ë‚´ë³´ë‚´ê¸°
        function exportCurrentSection() {
            if (!currentFile || !currentSection) {
                alert('ë¨¼ì € íŒŒì¼ê³¼ ì„¹ì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const sections = parsedSections.get(currentFile);
            const section = sections.get(currentSection);
            
            const exportData = {
                filename: fileData.get(currentFile).name,
                section: section.title,
                blocks: section.blocks.map(block => ({
                    title: block.contextualTitle,
                    signature: block.signature,
                    lines: `${block.startLine}-${block.endLine}`,
                    type: block.type,
                    content: block.content
                }))
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${section.title.replace(/[^\w]/g, '_')}_blocks.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ì´ˆê¸°í™”
        function clearAll() {
            fileData.clear();
            currentFile = null;
            currentSection = null;
            parsedSections.clear();
            
            renderFileTree();
            document.getElementById('sectionNav').innerHTML = '<div class="empty-state"><h3>ğŸ¯ ì„¹ì…˜ ëª©ë¡</h3><p>íŒŒì¼ì„ ì„ íƒí•˜ë©´<br>ì½”ë“œ ì„¹ì…˜ì´ í‘œì‹œë©ë‹ˆë‹¤</p></div>';
            document.getElementById('currentSectionName').textContent = 'ì„¹ì…˜ì„ ì„ íƒí•˜ì„¸ìš”';
            document.getElementById('currentSectionDetails').textContent = 'ì¢Œì¸¡ì—ì„œ ì„¹ì…˜ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ ì½”ë“œ ë¸”ë¡ë“¤ì´ í‘œì‹œë©ë‹ˆë‹¤';
            document.getElementById('viewerContent').innerHTML = '<div class="empty-state"><h3>ğŸš€ ì½”ë“œ ë¸”ë¡ ë·°ì–´ v2 (ìˆ˜ì •)</h3><p>íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”!</p></div>';
        }

        // ë¬¸ë²• í•˜ì´ë¼ì´íŒ… (v1ê³¼ ë™ì¼)
        function highlightCode(code, ext) {
            let highlighted = escapeHtml(code);

            if (ext === '.js' || ext === '.jsx' || ext === '.ts' || ext === '.tsx') {
                const keywords = ['function', 'const', 'let', 'var', 'class', 'if', 'else', 'for', 'while', 'return', 'import', 'export', 'default', 'async', 'await', 'try', 'catch', 'finally', 'this', 'super', 'extends', 'static', 'public', 'private', 'protected'];
                keywords.forEach(keyword => {
                    const regex = new RegExp(`\\b(${keyword})\\b`, 'g');
                    highlighted = highlighted.replace(regex, '<span class="keyword">$1</span>');
                });
            } else if (ext === '.py') {
                const keywords = ['def', 'class', 'if', 'elif', 'else', 'for', 'while', 'return', 'import', 'from', 'try', 'except', 'finally', 'with', 'as', 'and', 'or', 'not', 'in', 'is', 'None', 'True', 'False'];
                keywords.forEach(keyword => {
                    const regex = new RegExp(`\\b(${keyword})\\b`, 'g');
                    highlighted = highlighted.replace(regex, '<span class="keyword">$1</span>');
                });
            }

            // ë¬¸ìì—´
            highlighted = highlighted.replace(/(['"`])((?:\\.|(?!\1)[^\\])*?)\1/g, '<span class="string">$1$2$1</span>');
            
            // ì£¼ì„
            highlighted = highlighted.replace(/(\/\/.*$|\/\*[\s\S]*?\*\/|#.*$)/gm, '<span class="comment">$1</span>');
            
            // ìˆ«ì
            highlighted = highlighted.replace(/\b(\d+\.?\d*)\b/g, '<span class="number">$1</span>');
            
            // í”„ë¡œí¼í‹° (ì  í‘œê¸°ë²•)
            highlighted = highlighted.replace(/\.(\w+)/g, '.<span class="property">$1</span>');
            
            // ê´„í˜¸
            highlighted = highlighted.replace(/([{}[\]()])/g, '<span class="bracket">$1</span>');

            return highlighted;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“¦ ì½”ë“œ ë¸”ë¡ ë·°ì–´ v2 (ìˆ˜ì •) ì¤€ë¹„ ì™„ë£Œ!');
        });
    </script>
</body>
</html>