<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì¶ ÏΩîÎìú Î∏îÎ°ù Î∑∞Ïñ¥ v2 (ÏàòÏ†ï) - ÏÑπÏÖò ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Consolas', 'Monaco', 'JetBrains Mono', monospace;
            background: #0d1117;
            color: #f0f6fc;
            height: 100vh;
            overflow: hidden;
        }

        /* Ìó§Îçî */
        .header {
            background: linear-gradient(135deg, #1e2328 0%, #2d333b 100%);
            padding: 20px;
            border-bottom: 1px solid #30363d;
        }

        .header h1 {
            color: #58a6ff;
            font-size: 24px;
            margin-bottom: 8px;
        }

        .header p {
            color: #8b949e;
            font-size: 14px;
        }

        /* ÏóÖÎ°úÎìú ÏòÅÏó≠ */
        .upload-section {
            background: #161b22;
            padding: 15px 20px;
            border-bottom: 1px solid #30363d;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .upload-zone {
            flex: 1;
            border: 2px dashed #30363d;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #0d1117;
        }

        .upload-zone:hover,
        .upload-zone.dragover {
            border-color: #58a6ff;
            background: #0c2d6b;
        }

        .upload-buttons {
            display: flex;
            gap: 10px;
        }

        .upload-btn {
            padding: 8px 16px;
            background: #238636;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
            font-family: inherit;
        }

        .upload-btn:hover {
            background: #2ea043;
        }

        .upload-btn.secondary {
            background: #21262d;
            color: #f0f6fc;
        }

        .upload-btn.secondary:hover {
            background: #30363d;
        }

        /* Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà */
        .main-container {
            display: flex;
            height: calc(100vh - 140px);
        }

        /* ÌååÏùº Ìä∏Î¶¨ (Ï¢åÏ∏° Ï≤´ Î≤àÏß∏) */
        .file-sidebar {
            width: 280px;
            background: #0d1117;
            border-right: 1px solid #30363d;
            overflow-y: auto;
            resize: horizontal;
            min-width: 200px;
            max-width: 400px;
        }

        .file-tree {
            padding: 15px;
        }

        .tree-item {
            padding: 6px 12px;
            cursor: pointer;
            border-radius: 6px;
            margin: 2px 0;
            user-select: none;
            font-size: 13px;
            transition: background 0.2s;
        }

        .tree-item:hover {
            background: #21262d;
        }

        .tree-item.active {
            background: #1f6feb;
            color: #ffffff;
        }

        .tree-item.folder {
            font-weight: 600;
            color: #58a6ff;
        }

        .tree-item.file {
            padding-left: 24px;
            color: #e6edf3;
        }

        .tree-item.file::before {
            content: "üìÑ ";
            margin-right: 6px;
        }

        .tree-item.folder::before {
            content: "üìÅ ";
            margin-right: 6px;
        }

        .tree-item.folder.expanded::before {
            content: "üìÇ ";
        }

        /* ÏÑπÏÖò ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò (Ï¢åÏ∏° Îëê Î≤àÏß∏) */
        .section-nav {
            width: 300px;
            background: #161b22;
            border-right: 1px solid #30363d;
            overflow-y: auto;
            resize: horizontal;
            min-width: 250px;
            max-width: 450px;
        }

        .nav-header {
            padding: 20px;
            border-bottom: 1px solid #30363d;
            background: #21262d;
        }

        .nav-title {
            color: #58a6ff;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .nav-subtitle {
            color: #8b949e;
            font-size: 12px;
        }

        .nav-list {
            list-style: none;
            padding: 15px;
        }

        .nav-item {
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 6px;
            margin: 3px 0;
            user-select: none;
            font-size: 13px;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            position: relative;
        }

        .nav-item:hover {
            background: #21262d;
            border-left-color: #30363d;
        }

        .nav-item.active {
            background: #0d419d;
            border-left-color: #58a6ff;
            color: #ffffff;
        }

        .nav-item .section-title {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .nav-item .section-info {
            font-size: 11px;
            color: #8b949e;
        }

        .nav-item.active .section-info {
            color: #cae8ff;
        }

        .nav-item .block-count {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: #30363d;
            color: #f0f6fc;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 500;
        }

        .nav-item.active .block-count {
            background: #388bfd;
        }

        /* ÏΩîÎìú Î∑∞Ïñ¥ (Ïö∞Ï∏°) */
        .code-viewer {
            flex: 1;
            background: #0d1117;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .viewer-header {
            background: #161b22;
            padding: 15px 20px;
            border-bottom: 1px solid #30363d;
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .current-section {
            flex: 1;
        }

        .section-name {
            color: #58a6ff;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .section-details {
            color: #8b949e;
            font-size: 12px;
        }

        .viewer-controls {
            display: flex;
            gap: 8px;
        }

        .viewer-btn {
            padding: 6px 12px;
            background: #21262d;
            color: #f0f6fc;
            border: 1px solid #30363d;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s;
            font-family: inherit;
        }

        .viewer-btn:hover {
            background: #30363d;
            border-color: #40464f;
        }

        .viewer-content {
            flex: 1;
            padding: 20px;
        }

        /* ÏΩîÎìú Î∏îÎ°ù */
        .code-block {
            margin-bottom: 20px;
            border: 1px solid #30363d;
            border-radius: 8px;
            background: #161b22;
            overflow: hidden;
        }

        .block-header {
            background: #21262d;
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #30363d;
            user-select: none;
        }

        .block-header:hover {
            background: #30363d;
        }

        .block-title-section {
            flex: 1;
        }

        .block-title {
            font-weight: 600;
            color: #58a6ff;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .block-signature {
            font-size: 12px;
            color: #8b949e;
            font-family: 'Consolas', monospace;
        }

        .block-meta {
            text-align: right;
        }

        .block-lines {
            font-size: 11px;
            color: #8b949e;
            margin-bottom: 2px;
        }

        .block-type {
            font-size: 10px;
            color: #79c0ff;
            background: #0c2d6b;
            padding: 2px 6px;
            border-radius: 3px;
        }

        .block-toggle {
            color: #8b949e;
            font-size: 12px;
            margin-left: 10px;
            transition: transform 0.2s;
        }

        .block-toggle.collapsed {
            transform: rotate(-90deg);
        }

        .block-content {
            background: #0d1117;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .block-content.collapsed {
            height: 0;
        }

        .block-preview {
            padding: 12px 16px;
            color: #8b949e;
            font-size: 12px;
            background: #161b22;
            border-top: 1px solid #21262d;
            display: none;
        }

        .code-block.collapsed .block-preview {
            display: block;
        }

        .code-content {
            padding: 16px;
        }

        pre {
            margin: 0;
            padding: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Consolas', 'Monaco', 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.5;
            color: #e6edf3;
        }

        /* Î¨∏Î≤ï ÌïòÏù¥ÎùºÏù¥ÌåÖ */
        .keyword { color: #ff7b72; font-weight: 600; }
        .string { color: #a5d6ff; }
        .comment { color: #8b949e; font-style: italic; }
        .number { color: #79c0ff; }
        .function { color: #d2a8ff; }
        .class { color: #7ee787; }
        .variable { color: #ffa657; }
        .operator { color: #f85149; }
        .bracket { color: #f0f6fc; }
        .property { color: #79c0ff; }

        /* Îπà ÏÉÅÌÉú */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #8b949e;
        }

        .empty-state h3 {
            color: #58a6ff;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .empty-state p {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        /* Ïä§ÌÅ¨Î°§Î∞î */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #161b22;
        }

        ::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #484f58;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 1200px) {
            .file-sidebar {
                width: 250px;
            }
            .section-nav {
                width: 280px;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .file-sidebar,
            .section-nav {
                width: 100%;
                height: 150px;
                resize: none;
            }
            
            .upload-section {
                flex-direction: column;
                gap: 10px;
            }
            
            .upload-zone {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Ìó§Îçî -->
    <header class="header">
        <h1>üì¶ ÏΩîÎìú Î∏îÎ°ù Î∑∞Ïñ¥ v2 (ÏàòÏ†ï)</h1>
        <p>ÏÑπÏÖò ÎÑ§ÎπÑÍ≤åÏù¥ÏÖòÏúºÎ°ú ÏΩîÎìúÎ•º Îçî Ï≤¥Í≥ÑÏ†ÅÏúºÎ°ú ÌÉêÏÉâÌïòÏÑ∏Ïöî</p>
    </header>

    <!-- ÏóÖÎ°úÎìú ÏÑπÏÖò -->
    <div class="upload-section">
        <div class="upload-zone" id="uploadZone">
            <div style="font-size: 16px; margin-bottom: 5px;">üéØ ÌååÏùºÏù¥ÎÇò Ìè¥ÎçîÎ•º ÎÅåÏñ¥ÎÜìÏúºÏÑ∏Ïöî</div>
            <div style="font-size: 11px; color: #8b949e;">JavaScript, TypeScript, Python, CSS, HTML, JSON ÏßÄÏõê</div>
        </div>
        <div class="upload-buttons">
            <button class="upload-btn" onclick="selectFiles()">üìÑ ÌååÏùº ÏÑ†ÌÉù</button>
            <button class="upload-btn" onclick="selectFolder()">üìÅ Ìè¥Îçî ÏÑ†ÌÉù</button>
            <button class="upload-btn secondary" onclick="clearAll()">üóëÔ∏è Ï¥àÍ∏∞Ìôî</button>
        </div>
    </div>

    <!-- Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà -->
    <div class="main-container">
        <!-- ÌååÏùº Ìä∏Î¶¨ -->
        <div class="file-sidebar">
            <div class="file-tree" id="fileTree">
                <div class="empty-state">
                    <h3>üìÅ ÌååÏùº Ìä∏Î¶¨</h3>
                    <p>ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÎ©¥<br>Ïó¨Í∏∞Ïóê ÌååÏùº Î™©Î°ùÏù¥ ÌëúÏãúÎê©ÎãàÎã§</p>
                </div>
            </div>
        </div>

        <!-- ÏÑπÏÖò ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
        <nav class="section-nav">
            <div class="nav-header">
                <div class="nav-title">ÏΩîÎìú ÏÑπÏÖò</div>
                <div class="nav-subtitle">Î∏îÎ°ùÏùÑ Ï¢ÖÎ•òÎ≥ÑÎ°ú Î∂ÑÎ•ò</div>
            </div>
            <ul class="nav-list" id="sectionNav">
                <div class="empty-state">
                    <h3>üéØ ÏÑπÏÖò Î™©Î°ù</h3>
                    <p>ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÎ©¥<br>ÏΩîÎìú ÏÑπÏÖòÏù¥ ÌëúÏãúÎê©ÎãàÎã§</p>
                </div>
            </ul>
        </nav>

        <!-- ÏΩîÎìú Î∑∞Ïñ¥ -->
        <div class="code-viewer">
            <div class="viewer-header">
                <div class="current-section">
                    <div class="section-name" id="currentSectionName">ÏÑπÏÖòÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
                    <div class="section-details" id="currentSectionDetails">Ï¢åÏ∏°ÏóêÏÑú ÏÑπÏÖòÏùÑ ÏÑ†ÌÉùÌïòÎ©¥ Ìï¥Îãπ ÏΩîÎìú Î∏îÎ°ùÎì§Ïù¥ ÌëúÏãúÎê©ÎãàÎã§</div>
                </div>
                <div class="viewer-controls">
                    <button class="viewer-btn" onclick="expandAllBlocks()">Î™®Îëê ÌéºÏπòÍ∏∞</button>
                    <button class="viewer-btn" onclick="collapseAllBlocks()">Î™®Îëê Ï†ëÍ∏∞</button>
                    <button class="viewer-btn" onclick="exportCurrentSection()">ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
                </div>
            </div>
            <div class="viewer-content" id="viewerContent">
                <div class="empty-state">
                    <h3>üöÄ ÏΩîÎìú Î∏îÎ°ù Î∑∞Ïñ¥ v2 (ÏàòÏ†ï)</h3>
                    <p>‚ú® <strong>ÏàòÏ†ïÎêú Í∏∞Îä•:</strong></p>
                    <p>‚Ä¢ Îçî Ï†ïÌôïÌïú {} Í¥ÑÌò∏ Îã®ÏúÑ Ïù∏Ïãù</p>
                    <p>‚Ä¢ Ìñ•ÏÉÅÎêú Ìï®Ïàò/ÌÅ¥ÎûòÏä§ ÌååÏã±</p>
                    <p>‚Ä¢ Ï§ëÎ≥µ Ï†úÎ™© Î¨∏Ï†ú Ìï¥Í≤∞</p>
                    <p>‚Ä¢ ÏÑπÏÖòÎ≥Ñ Ï≤¥Í≥ÑÏ†Å Î∂ÑÎ•ò</p>
                    <br>
                    <p>ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÏó¨ ÏãúÏûëÌïòÏÑ∏Ïöî!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Ïà®Í≤®ÏßÑ ÏûÖÎ†• ÏöîÏÜåÎì§ -->
    <input type="file" id="fileInput" multiple accept=".js,.jsx,.ts,.tsx,.py,.css,.html,.json,.vue,.php,.java,.cs,.cpp,.c" style="display: none;">
    <input type="file" id="folderInput" webkitdirectory style="display: none;">

    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàòÎì§
        let fileData = new Map();
        let currentFile = null;
        let currentSection = null;
        let parsedSections = new Map();

        // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ ÏÑ§Ï†ï (v1Í≥º ÎèôÏùº)
        const uploadZone = document.getElementById('uploadZone');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadZone.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadZone.addEventListener(eventName, () => {
                uploadZone.classList.add('dragover');
            });
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadZone.addEventListener(eventName, () => {
                uploadZone.classList.remove('dragover');
            });
        });

        uploadZone.addEventListener('drop', handleDrop);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(Array.from(files));
        }

        // ÌååÏùº ÏÑ†ÌÉù Ìï®ÏàòÎì§ (v1Í≥º ÎèôÏùº)
        function selectFiles() {
            document.getElementById('fileInput').click();
        }

        function selectFolder() {
            document.getElementById('folderInput').click();
        }

        document.getElementById('fileInput').addEventListener('change', function(e) {
            handleFiles(Array.from(e.target.files));
        });

        document.getElementById('folderInput').addEventListener('change', function(e) {
            handleFiles(Array.from(e.target.files));
        });

        // ÌååÏùº Ï≤òÎ¶¨ (v1Í≥º ÎèôÏùº)
        async function handleFiles(files) {
            const supportedExts = ['.js', '.jsx', '.ts', '.tsx', '.py', '.css', '.html', '.json', '.vue', '.php', '.java', '.cs', '.cpp', '.c'];
            const validFiles = files.filter(file => {
                const ext = '.' + file.name.split('.').pop().toLowerCase();
                return supportedExts.includes(ext);
            });

            if (validFiles.length === 0) {
                alert('ÏßÄÏõêÎêòÎäî ÌååÏùºÏù¥ ÏóÜÏäµÎãàÎã§.\nÏßÄÏõê ÌòïÏãù: ' + supportedExts.join(', '));
                return;
            }

            document.getElementById('fileTree').innerHTML = '<div class="empty-state"><h3>ÌååÏùº Î°úÎî©Ï§ë...</h3></div>';

            for (const file of validFiles) {
                try {
                    const content = await readFileContent(file);
                    const filePath = file.webkitRelativePath || file.name;
                    fileData.set(filePath, {
                        name: file.name,
                        path: filePath,
                        content: content,
                        size: file.size,
                        lastModified: file.lastModified
                    });
                } catch (error) {
                    console.error('ÌååÏùº ÏùΩÍ∏∞ Ïã§Ìå®:', file.name, error);
                }
            }

            renderFileTree();
        }

        function readFileContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsText(file, 'UTF-8');
            });
        }

        // ÌååÏùº Ìä∏Î¶¨ Î†åÎçîÎßÅ (v1Í≥º ÎèôÏùº)
        function renderFileTree() {
            const fileTree = document.getElementById('fileTree');
            const files = Array.from(fileData.keys()).sort();
            
            if (files.length === 0) {
                fileTree.innerHTML = '<div class="empty-state"><h3>üìÅ ÌååÏùº Ìä∏Î¶¨</h3><p>ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÏÑ∏Ïöî</p></div>';
                return;
            }

            const tree = buildFileTree(files);
            fileTree.innerHTML = renderTreeHTML(tree);
        }

        function buildFileTree(filePaths) {
            const tree = {};
            
            filePaths.forEach(path => {
                const parts = path.split('/');
                let current = tree;
                
                parts.forEach((part, index) => {
                    if (!current[part]) {
                        current[part] = index === parts.length - 1 ? { 
                            type: 'file', 
                            path: path 
                        } : { 
                            type: 'folder', 
                            children: {} 
                        };
                    }
                    if (current[part].children) {
                        current = current[part].children;
                    }
                });
            });

            return tree;
        }

        function renderTreeHTML(tree, level = 0) {
            let html = '';
            
            Object.entries(tree).forEach(([name, node]) => {
                if (node.type === 'file') {
                    const file = fileData.get(node.path);
                    const size = formatFileSize(file.size);
                    html += `<div class="tree-item file" onclick="selectFile('${node.path}')" title="${node.path} (${size})">${name}</div>`;
                } else {
                    html += `<div class="tree-item folder" onclick="toggleFolder(this)">${name}</div>`;
                    html += `<div style="margin-left: 20px;">${renderTreeHTML(node.children, level + 1)}</div>`;
                }
            });

            return html;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function toggleFolder(element) {
            element.classList.toggle('expanded');
            const next = element.nextElementSibling;
            if (next) {
                next.style.display = next.style.display === 'none' ? 'block' : 'none';
            }
        }

        // ÌååÏùº ÏÑ†ÌÉù Î∞è ÏÑπÏÖò ÌååÏã± (v1 Í∏∞Î∞òÏúºÎ°ú ÏàòÏ†ï)
        function selectFile(filePath) {
            // Ïù¥Ï†Ñ ÏÑ†ÌÉù Ìï¥Ï†ú
            document.querySelectorAll('.tree-item.active').forEach(item => {
                item.classList.remove('active');
            });

            // ÏÉà ÏÑ†ÌÉù ÌëúÏãú
            const fileItem = document.querySelector(`[onclick="selectFile('${filePath}')"]`);
            if (fileItem) {
                fileItem.classList.add('active');
            }

            currentFile = filePath;
            const file = fileData.get(filePath);
            
            if (file) {
                parseFileIntoSections(file);
            }
        }

        function parseFileIntoSections(file) {
            const ext = '.' + file.name.split('.').pop().toLowerCase();
            
            // v1Ïùò ÌååÏã± Î°úÏßÅ ÏÇ¨Ïö© (Îçî Ï†ïÌôïÌï®)
            const blocks = parseCodeBlocksV1(file.content, ext);
            
            console.log('ÌååÏã±Îêú Î∏îÎ°ù Ïàò:', blocks.length);
            console.log('Î∏îÎ°ùÎì§:', blocks);
            
            // ÏÑπÏÖòÎ≥ÑÎ°ú Î∂ÑÎ•ò
            const sections = categorizeBlocks(blocks, ext);
            parsedSections.set(currentFile, sections);
            
            renderSectionNav(sections);
            
            // Ï≤´ Î≤àÏß∏ ÏÑπÏÖò ÏûêÎèô ÏÑ†ÌÉù
            if (sections.size > 0) {
                const firstSection = sections.keys().next().value;
                selectSection(firstSection);
            } else {
                // ÏÑπÏÖòÏù¥ ÏóÜÏúºÎ©¥ Ï†ÑÏ≤¥ ÌëúÏãú
                const allSection = new Map();
                allSection.set('all', {
                    title: 'Ï†ÑÏ≤¥ ÏΩîÎìú',
                    blocks: [{
                        contextualTitle: file.name,
                        signature: `Ï†ÑÏ≤¥ ÌååÏùº (${file.content.split('\n').length}Ï§Ñ)`,
                        content: file.content,
                        startLine: 1,
                        endLine: file.content.split('\n').length,
                        type: 'file'
                    }],
                    icon: 'üìÑ'
                });
                parsedSections.set(currentFile, allSection);
                renderSectionNav(allSection);
                selectSection('all');
            }
        }

        // v1Ïùò Ï†ïÌôïÌïú ÌååÏã± Î°úÏßÅ ÏÇ¨Ïö©
        function parseCodeBlocksV1(content, fileExt) {
            const lines = content.split('\n');
            const blocks = [];

            if (fileExt === '.js' || fileExt === '.jsx' || fileExt === '.ts' || fileExt === '.tsx') {
                return parseJavaScriptBlocksV1(lines);
            } else if (fileExt === '.py') {
                return parsePythonBlocksV1(lines);
            } else if (fileExt === '.css') {
                return parseCSSBlocksV1(lines);
            } else if (fileExt === '.json') {
                return parseJSONBlocksV1(lines);
            } else {
                return parseGenericBlocksV1(lines);
            }
        }

        function parseJavaScriptBlocksV1(lines) {
            const blocks = [];
            let i = 0;
            
            while (i < lines.length) {
                const line = lines[i].trim();
                
                // Ìï®Ïàò Í≤ÄÏÉâ
                if (line.match(/^(function\s+\w+|const\s+\w+\s*=\s*(?:async\s*)?\(|class\s+\w+|export\s+(?:default\s+)?(?:function|class)\s+\w+)/)) {
                    const block = extractBlockV1(lines, i, line);
                    if (block) {
                        block.contextualTitle = generateContextualTitle(line, 'function');
                        block.signature = line.substring(0, 100);
                        block.type = determineBlockType(line);
                        blocks.push(block);
                        i = block.endLine;
                    }
                } else if (line.match(/^\w+\s*:\s*(?:async\s*)?\(|^\w+\s*\(/)) {
                    // Í∞ùÏ≤¥ Î©îÏÑúÎìúÎÇò Ìï®Ïàò Ìò∏Ï∂ú
                    const block = extractBlockV1(lines, i, line);
                    if (block) {
                        block.contextualTitle = generateContextualTitle(line, 'method');
                        block.signature = line.substring(0, 100);
                        block.type = 'method';
                        blocks.push(block);
                        i = block.endLine;
                    }
                }
                i++;
            }
            
            return blocks;
        }

        function parsePythonBlocksV1(lines) {
            const blocks = [];
            let i = 0;
            
            while (i < lines.length) {
                const line = lines[i].trim();
                
                // Ìï®ÏàòÎÇò ÌÅ¥ÎûòÏä§ Í≤ÄÏÉâ
                if (line.match(/^(def\s+\w+|class\s+\w+)/)) {
                    const block = extractPythonBlockV1(lines, i, line);
                    if (block) {
                        block.contextualTitle = generateContextualTitle(line, 'python');
                        block.signature = line.substring(0, 100);
                        block.type = line.startsWith('class') ? 'class' : 'function';
                        blocks.push(block);
                        i = block.endLine;
                    }
                }
                i++;
            }
            
            return blocks;
        }

        function parseCSSBlocksV1(lines) {
            const blocks = [];
            let i = 0;
            
            while (i < lines.length) {
                const line = lines[i].trim();
                
                // CSS ÏÑ†ÌÉùÏûê Í≤ÄÏÉâ
                if (line.match(/^[.#]?[\w-]+.*\{/) || line.match(/^@\w+/) || line.includes('{')) {
                    const block = extractCSSBlockV1(lines, i, line);
                    if (block) {
                        block.contextualTitle = generateContextualTitle(line, 'css');
                        block.signature = line.replace(/\s*\{.*/, '').trim();
                        block.type = line.startsWith('@media') ? 'media' : (line.startsWith('@keyframes') ? 'keyframes' : 'selector');
                        blocks.push(block);
                        i = block.endLine;
                    }
                }
                i++;
            }
            
            return blocks;
        }

        function parseJSONBlocksV1(lines) {
            const blocks = [];
            let i = 0;
            let depth = 0;
            
            while (i < lines.length) {
                const line = lines[i].trim();
                
                if (line.includes('{') || line.includes('[')) {
                    const startLine = i + 1;
                    const startContent = line;
                    let content = line + '\n';
                    depth = (line.match(/\{/g) || []).length - (line.match(/\}/g) || []).length;
                    depth += (line.match(/\[/g) || []).length - (line.match(/\]/g) || []).length;
                    i++;
                    
                    while (i < lines.length && depth > 0) {
                        const currentLine = lines[i];
                        content += currentLine + '\n';
                        depth += (currentLine.match(/\{/g) || []).length - (currentLine.match(/\}/g) || []).length;
                        depth += (currentLine.match(/\[/g) || []).length - (currentLine.match(/\]/g) || []).length;
                        i++;
                    }
                    
                    if (content.trim()) {
                        blocks.push({
                            contextualTitle: generateContextualTitle(startContent, 'json'),
                            signature: startContent.length > 50 ? startContent.substring(0, 50) + '...' : startContent,
                            content: content.trim(),
                            startLine: startLine,
                            endLine: i,
                            type: 'object'
                        });
                    }
                } else {
                    i++;
                }
            }
            
            return blocks;
        }

        function parseGenericBlocksV1(lines) {
            const blocks = [];
            let i = 0;
            
            while (i < lines.length) {
                const line = lines[i].trim();
                
                // Í∞ÑÎã®Ìïú Ìï®ÏàòÎÇò Î©îÏÑúÎìú Ìå®ÌÑ¥ Í≤ÄÏÉâ
                if (line.match(/^\w+.*\{/) && !line.includes(';')) {
                    const block = extractBlockV1(lines, i, line);
                    if (block) {
                        block.contextualTitle = generateContextualTitle(line, 'generic');
                        block.signature = line;
                        block.type = 'generic';
                        blocks.push(block);
                        i = block.endLine;
                    }
                }
                i++;
            }
            
            return blocks;
        }

        // v1 Î∏îÎ°ù Ï∂îÏ∂ú Ìï®ÏàòÎì§
        function extractBlockV1(lines, startIndex, startLine) {
            let braceCount = 0;
            let content = '';
            let i = startIndex;
            let foundOpenBrace = false;
            
            while (i < lines.length) {
                const line = lines[i];
                content += line + '\n';
                
                const openBraces = (line.match(/\{/g) || []).length;
                const closeBraces = (line.match(/\}/g) || []).length;
                
                braceCount += openBraces - closeBraces;
                
                if (openBraces > 0) foundOpenBrace = true;
                
                if (foundOpenBrace && braceCount === 0) {
                    return {
                        content: content.trim(),
                        startLine: startIndex + 1,
                        endLine: i + 1
                    };
                }
                
                i++;
            }
            
            return null;
        }

        function extractPythonBlockV1(lines, startIndex, startLine) {
            let content = lines[startIndex] + '\n';
            let i = startIndex + 1;
            let baseIndent = lines[startIndex].search(/\S/);
            
            while (i < lines.length) {
                const line = lines[i];
                const lineIndent = line.search(/\S/);
                
                if (line.trim() === '') {
                    content += line + '\n';
                    i++;
                    continue;
                }
                
                if (lineIndent <= baseIndent && line.trim() !== '') {
                    break;
                }
                
                content += line + '\n';
                i++;
            }
            
            return {
                content: content.trim(),
                startLine: startIndex + 1,
                endLine: i
            };
        }

        function extractCSSBlockV1(lines, startIndex, startLine) {
            let braceCount = 0;
            let content = '';
            let i = startIndex;
            
            while (i < lines.length) {
                const line = lines[i];
                content += line + '\n';
                
                braceCount += (line.match(/\{/g) || []).length;
                braceCount -= (line.match(/\}/g) || []).length;
                
                if (braceCount === 0 && content.includes('{')) {
                    return {
                        content: content.trim(),
                        startLine: startIndex + 1,
                        endLine: i + 1
                    };
                }
                
                i++;
            }
            
            return null;
        }

        // Ïª®ÌÖçÏä§Ìä∏Î≥Ñ Ï†úÎ™© ÏÉùÏÑ± (Ï§ëÎ≥µ Ìï¥Í≤∞)
        function generateContextualTitle(line, context) {
            const trimmed = line.trim();
            
            if (context === 'function') {
                // JavaScript Ìï®Ïàò
                let match = trimmed.match(/function\s+(\w+)/);
                if (match) return `${match[1]}() (Ìï®Ïàò)`;
                
                match = trimmed.match(/const\s+(\w+)\s*=/);
                if (match) return `${match[1]}() (ÌôîÏÇ¥Ìëú Ìï®Ïàò)`;
                
                match = trimmed.match(/class\s+(\w+)/);
                if (match) return `${match[1]} (ÌÅ¥ÎûòÏä§)`;
                
                return trimmed.substring(0, 30) + '... (Ìï®Ïàò)';
            }
            
            if (context === 'method') {
                const match = trimmed.match(/(\w+)\s*[:(/]/);
                if (match) return `${match[1]}() (Î©îÏÑúÎìú)`;
                return trimmed.substring(0, 30) + '... (Î©îÏÑúÎìú)';
            }
            
            if (context === 'python') {
                let match = trimmed.match(/def\s+(\w+)/);
                if (match) return `${match[1]}() (Python Ìï®Ïàò)`;
                
                match = trimmed.match(/class\s+(\w+)/);
                if (match) return `${match[1]} (Python ÌÅ¥ÎûòÏä§)`;
                
                return trimmed.substring(0, 30) + '...';
            }
            
            if (context === 'css') {
                if (trimmed.startsWith('@media')) return `ÎØ∏ÎîîÏñ¥ ÏøºÎ¶¨: ${trimmed.substring(0, 30)}`;
                if (trimmed.startsWith('@keyframes')) {
                    const match = trimmed.match(/@keyframes\s+(\w+)/);
                    return match ? `${match[1]} (ÌÇ§ÌîÑÎ†àÏûÑ)` : 'ÌÇ§ÌîÑÎ†àÏûÑ';
                }
                const selector = trimmed.replace(/\s*\{.*/, '').trim();
                return `${selector} (ÏÑ†ÌÉùÏûê)`;
            }
            
            if (context === 'json') {
                const key = trimmed.replace(/[{[\s:].*/g, '').replace(/['"]/g, '');
                return key ? `${key} (JSON)` : 'JSON Î∏îÎ°ù';
            }
            
            return trimmed.substring(0, 50);
        }

        function determineBlockType(line) {
            if (line.includes('class')) return 'class';
            if (line.includes('function') || line.includes('=>')) return 'function';
            if (line.match(/^const\s+[A-Z]/)) return 'component'; // React component
            if (line.match(/^const\s+use[A-Z]/)) return 'hook'; // React hook
            return 'function';
        }

        function categorizeBlocks(blocks, ext) {
            const sections = new Map();
            
            if (ext === '.js' || ext === '.jsx' || ext === '.ts' || ext === '.tsx') {
                // JavaScript/TypeScript ÏÑπÏÖò Î∂ÑÎ•ò
                sections.set('functions', { 
                    title: 'üîß Ìï®Ïàò (Functions)', 
                    blocks: blocks.filter(b => ['function', 'method'].includes(b.type)),
                    icon: 'üîß'
                });
                sections.set('classes', { 
                    title: 'üèóÔ∏è ÌÅ¥ÎûòÏä§ (Classes)', 
                    blocks: blocks.filter(b => b.type === 'class'),
                    icon: 'üèóÔ∏è'
                });
                sections.set('components', { 
                    title: 'üß© Ïª¥Ìè¨ÎÑåÌä∏ (Components)', 
                    blocks: blocks.filter(b => b.type === 'component'),
                    icon: 'üß©'
                });
                sections.set('hooks', { 
                    title: 'üé£ ÌõÖ (Hooks)', 
                    blocks: blocks.filter(b => b.type === 'hook'),
                    icon: 'üé£'
                });
                sections.set('other', { 
                    title: 'üìÑ Í∏∞ÌÉÄ (Other)', 
                    blocks: blocks.filter(b => !['function', 'class', 'component', 'hook', 'method'].includes(b.type)),
                    icon: 'üìÑ'
                });
            } else if (ext === '.py') {
                // Python ÏÑπÏÖò Î∂ÑÎ•ò
                sections.set('classes', { 
                    title: 'üèóÔ∏è ÌÅ¥ÎûòÏä§ (Classes)', 
                    blocks: blocks.filter(b => b.type === 'class'),
                    icon: 'üèóÔ∏è'
                });
                sections.set('functions', { 
                    title: 'üîß Ìï®Ïàò (Functions)', 
                    blocks: blocks.filter(b => b.type === 'function'),
                    icon: 'üîß'
                });
            } else if (ext === '.css') {
                // CSS ÏÑπÏÖò Î∂ÑÎ•ò
                sections.set('selectors', { 
                    title: 'üé® ÏÑ†ÌÉùÏûê (Selectors)', 
                    blocks: blocks.filter(b => b.type === 'selector'),
                    icon: 'üé®'
                });
                sections.set('media', { 
                    title: 'üì± ÎØ∏ÎîîÏñ¥ ÏøºÎ¶¨ (Media Queries)', 
                    blocks: blocks.filter(b => b.type === 'media'),
                    icon: 'üì±'
                });
                sections.set('keyframes', { 
                    title: 'üé¨ ÌÇ§ÌîÑÎ†àÏûÑ (Keyframes)', 
                    blocks: blocks.filter(b => b.type === 'keyframes'),
                    icon: 'üé¨'
                });
            } else {
                // Í∏∞ÌÉÄ ÌååÏùºÎì§
                sections.set('all', { 
                    title: 'üìÑ Î™®Îì† Î∏îÎ°ù (All Blocks)', 
                    blocks: blocks,
                    icon: 'üìÑ'
                });
            }
            
            // Îπà ÏÑπÏÖò Ï†úÍ±∞
            const nonEmptySections = new Map();
            sections.forEach((section, key) => {
                if (section.blocks.length > 0) {
                    nonEmptySections.set(key, section);
                }
            });
            
            return nonEmptySections;
        }

        // ÏÑπÏÖò ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î†åÎçîÎßÅ
        function renderSectionNav(sections) {
            const nav = document.getElementById('sectionNav');
            let html = '';
            
            sections.forEach((section, key) => {
                html += `
                <li class="nav-item" onclick="selectSection('${key}')" data-section="${key}">
                    <div class="section-title">${section.title}</div>
                    <div class="section-info">${section.blocks.length}Í∞ú Î∏îÎ°ù</div>
                    <div class="block-count">${section.blocks.length}</div>
                </li>
                `;
            });
            
            nav.innerHTML = html;
        }

        // ÏÑπÏÖò ÏÑ†ÌÉù
        function selectSection(sectionKey) {
            // Ïù¥Ï†Ñ ÏÑ†ÌÉù Ìï¥Ï†ú
            document.querySelectorAll('.nav-item.active').forEach(item => {
                item.classList.remove('active');
            });
            
            // ÏÉà ÏÑ†ÌÉù ÌëúÏãú
            const navItem = document.querySelector(`[data-section="${sectionKey}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }
            
            currentSection = sectionKey;
            const sections = parsedSections.get(currentFile);
            const section = sections.get(sectionKey);
            
            if (section) {
                renderSectionBlocks(section);
            }
        }

        function renderSectionBlocks(section) {
            const sectionName = document.getElementById('currentSectionName');
            const sectionDetails = document.getElementById('currentSectionDetails');
            const viewerContent = document.getElementById('viewerContent');
            
            sectionName.textContent = section.title;
            sectionDetails.textContent = `${section.blocks.length}Í∞úÏùò ÏΩîÎìú Î∏îÎ°ù`;
            
            if (section.blocks.length === 0) {
                viewerContent.innerHTML = '<div class="empty-state"><h3>Îπà ÏÑπÏÖò</h3><p>Ïù¥ ÏÑπÏÖòÏóêÎäî ÏΩîÎìú Î∏îÎ°ùÏù¥ ÏóÜÏäµÎãàÎã§.</p></div>';
                return;
            }
            
            let html = '';
            section.blocks.forEach((block, index) => {
                const preview = block.content.split('\n')[0].trim().substring(0, 100) + '...';
                const blockId = `${currentSection}-${index}`;
                
                html += `
                <div class="code-block" id="block-${blockId}">
                    <div class="block-header" onclick="toggleBlock('${blockId}')">
                        <div class="block-title-section">
                            <div class="block-title">${escapeHtml(block.contextualTitle || 'Unknown')}</div>
                            <div class="block-signature">${escapeHtml(block.signature || '')}</div>
                        </div>
                        <div class="block-meta">
                            <div class="block-lines">Ï§Ñ ${block.startLine}-${block.endLine}</div>
                            <div class="block-type">${getBlockTypeLabel(block.type)}</div>
                        </div>
                        <div class="block-toggle">‚ñº</div>
                    </div>
                    <div class="block-preview">${escapeHtml(preview)}</div>
                    <div class="block-content">
                        <div class="code-content">
                            <pre><code>${highlightCode(block.content, getFileExtension())}</code></pre>
                        </div>
                    </div>
                </div>
                `;
            });
            
            viewerContent.innerHTML = html;
        }

        function getBlockTypeLabel(type) {
            const labels = {
                'function': 'Ìï®Ïàò',
                'class': 'ÌÅ¥ÎûòÏä§',
                'component': 'Ïª¥Ìè¨ÎÑåÌä∏',
                'hook': 'ÌõÖ',
                'method': 'Î©îÏÑúÎìú',
                'selector': 'ÏÑ†ÌÉùÏûê',
                'media': 'ÎØ∏ÎîîÏñ¥ÏøºÎ¶¨',
                'keyframes': 'ÌÇ§ÌîÑÎ†àÏûÑ',
                'generic': 'Î∏îÎ°ù',
                'file': 'ÌååÏùº',
                'object': 'Í∞ùÏ≤¥'
            };
            return labels[type] || type;
        }

        function getFileExtension() {
            if (!currentFile) return '.js';
            return '.' + currentFile.split('.').pop().toLowerCase();
        }

        // Î∏îÎ°ù ÌÜ†Í∏Ä
        function toggleBlock(blockId) {
            const block = document.getElementById(`block-${blockId}`);
            const content = block.querySelector('.block-content');
            const toggle = block.querySelector('.block-toggle');
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                toggle.classList.remove('collapsed');
                block.classList.remove('collapsed');
            } else {
                content.classList.add('collapsed');
                toggle.classList.add('collapsed');
                block.classList.add('collapsed');
            }
        }

        // Ï†ÑÏ≤¥ Î∏îÎ°ù Ï†úÏñ¥
        function expandAllBlocks() {
            document.querySelectorAll('.block-content').forEach(content => {
                content.classList.remove('collapsed');
            });
            document.querySelectorAll('.block-toggle').forEach(toggle => {
                toggle.classList.remove('collapsed');
            });
            document.querySelectorAll('.code-block').forEach(block => {
                block.classList.remove('collapsed');
            });
        }

        function collapseAllBlocks() {
            document.querySelectorAll('.block-content').forEach(content => {
                content.classList.add('collapsed');
            });
            document.querySelectorAll('.block-toggle').forEach(toggle => {
                toggle.classList.add('collapsed');
            });
            document.querySelectorAll('.code-block').forEach(block => {
                block.classList.add('collapsed');
            });
        }

        // ÌòÑÏû¨ ÏÑπÏÖò ÎÇ¥Î≥¥ÎÇ¥Í∏∞
        function exportCurrentSection() {
            if (!currentFile || !currentSection) {
                alert('Î®ºÏ†Ä ÌååÏùºÍ≥º ÏÑπÏÖòÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const sections = parsedSections.get(currentFile);
            const section = sections.get(currentSection);
            
            const exportData = {
                filename: fileData.get(currentFile).name,
                section: section.title,
                blocks: section.blocks.map(block => ({
                    title: block.contextualTitle,
                    signature: block.signature,
                    lines: `${block.startLine}-${block.endLine}`,
                    type: block.type,
                    content: block.content
                }))
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${section.title.replace(/[^\w]/g, '_')}_blocks.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Ï¥àÍ∏∞Ìôî
        function clearAll() {
            fileData.clear();
            currentFile = null;
            currentSection = null;
            parsedSections.clear();
            
            renderFileTree();
            document.getElementById('sectionNav').innerHTML = '<div class="empty-state"><h3>üéØ ÏÑπÏÖò Î™©Î°ù</h3><p>ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÎ©¥<br>ÏΩîÎìú ÏÑπÏÖòÏù¥ ÌëúÏãúÎê©ÎãàÎã§</p></div>';
            document.getElementById('currentSectionName').textContent = 'ÏÑπÏÖòÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî';
            document.getElementById('currentSectionDetails').textContent = 'Ï¢åÏ∏°ÏóêÏÑú ÏÑπÏÖòÏùÑ ÏÑ†ÌÉùÌïòÎ©¥ Ìï¥Îãπ ÏΩîÎìú Î∏îÎ°ùÎì§Ïù¥ ÌëúÏãúÎê©ÎãàÎã§';
            document.getElementById('viewerContent').innerHTML = '<div class="empty-state"><h3>üöÄ ÏΩîÎìú Î∏îÎ°ù Î∑∞Ïñ¥ v2 (ÏàòÏ†ï)</h3><p>ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÏó¨ ÏãúÏûëÌïòÏÑ∏Ïöî!</p></div>';
        }

        // Î¨∏Î≤ï ÌïòÏù¥ÎùºÏù¥ÌåÖ (v1Í≥º ÎèôÏùº)
        function highlightCode(code, ext) {
            let highlighted = escapeHtml(code);

            if (ext === '.js' || ext === '.jsx' || ext === '.ts' || ext === '.tsx') {
                const keywords = ['function', 'const', 'let', 'var', 'class', 'if', 'else', 'for', 'while', 'return', 'import', 'export', 'default', 'async', 'await', 'try', 'catch', 'finally', 'this', 'super', 'extends', 'static', 'public', 'private', 'protected'];
                keywords.forEach(keyword => {
                    const regex = new RegExp(`\\b(${keyword})\\b`, 'g');
                    highlighted = highlighted.replace(regex, '<span class="keyword">$1</span>');
                });
            } else if (ext === '.py') {
                const keywords = ['def', 'class', 'if', 'elif', 'else', 'for', 'while', 'return', 'import', 'from', 'try', 'except', 'finally', 'with', 'as', 'and', 'or', 'not', 'in', 'is', 'None', 'True', 'False'];
                keywords.forEach(keyword => {
                    const regex = new RegExp(`\\b(${keyword})\\b`, 'g');
                    highlighted = highlighted.replace(regex, '<span class="keyword">$1</span>');
                });
            }

            // Î¨∏ÏûêÏó¥
            highlighted = highlighted.replace(/(['"`])((?:\\.|(?!\1)[^\\])*?)\1/g, '<span class="string">$1$2$1</span>');
            
            // Ï£ºÏÑù
            highlighted = highlighted.replace(/(\/\/.*$|\/\*[\s\S]*?\*\/|#.*$)/gm, '<span class="comment">$1</span>');
            
            // Ïà´Ïûê
            highlighted = highlighted.replace(/\b(\d+\.?\d*)\b/g, '<span class="number">$1</span>');
            
            // ÌîÑÎ°úÌçºÌã∞ (Ï†ê ÌëúÍ∏∞Î≤ï)
            highlighted = highlighted.replace(/\.(\w+)/g, '.<span class="property">$1</span>');
            
            // Í¥ÑÌò∏
            highlighted = highlighted.replace(/([{}[\]()])/g, '<span class="bracket">$1</span>');

            return highlighted;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üì¶ ÏΩîÎìú Î∏îÎ°ù Î∑∞Ïñ¥ v2 (ÏàòÏ†ï) Ï§ÄÎπÑ ÏôÑÎ£å!');
        });
    </script>
</body>
</html>