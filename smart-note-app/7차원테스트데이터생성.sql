-- 7차원 노트 시스템 테스트 데이터 생성
-- 실행 후 변화 확인용
-- 실행 방법: Supabase SQL Editor에서 실행

BEGIN;

-- ===== 기존 메시지에 7차원 데이터 추가 =====

-- 1. 우선순위 차원 테스트 데이터 (중요한 회의 메시지)
UPDATE 채팅메시지목록 
SET 우선순위차원 = '{
  "우선순위레벨": 4,
  "긴급도": "당일",
  "중요도매트릭스": {
    "긴급하고중요함": true,
    "중요하지만긴급하지않음": false,
    "긴급하지만중요하지않음": false,
    "긴급하지도중요하지도않음": false
  },
  "마감일": "2025-02-01T15:00:00Z",
  "예상소요시간": 90
}'::jsonb
WHERE 텍스트 LIKE '%회의%' OR 텍스트 LIKE '%중요%' OR 텍스트 LIKE '%프로젝트%'
LIMIT 3;

-- 2. 감정 차원 테스트 데이터 (긍정적 메시지)
UPDATE 채팅메시지목록 
SET 감정차원 = '{
  "기분상태": {
    "주감정": "기쁨",
    "전체강도": 8,
    "에너지레벨": 4
  },
  "텍스트톤": "긍정적",
  "감정노트": "새로운 아이디어가 떠올라서 기쁜 상태"
}'::jsonb
WHERE 텍스트 LIKE '%좋%' OR 텍스트 LIKE '%성공%' OR 텍스트 LIKE '%완료%'
LIMIT 3;

-- 3. 감정 차원 테스트 데이터 (중립적 메시지)
UPDATE 채팅메시지목록 
SET 감정차원 = '{
  "기분상태": {
    "주감정": "중립",
    "전체강도": 5,
    "에너지레벨": 3
  },
  "텍스트톤": "중립적"
}'::jsonb
WHERE 텍스트 LIKE '%일반%' OR 텍스트 LIKE '%메모%' OR 텍스트 LIKE '%기록%'
LIMIT 2;

-- 4. 맥락 차원 테스트 데이터 (업무 상황)
UPDATE 채팅메시지목록 
SET 맥락차원 = '{
  "상황유형": "업무",
  "작성목적": "계획",
  "환경정보": {
    "디바이스": "PC",
    "집중도": 4,
    "네트워크상태": "온라인"
  },
  "위치정보": {
    "장소명": "사무실",
    "장소유형": "사무실"
  },
  "컨텍스트노트": "업무 계획 수립 중"
}'::jsonb
WHERE 텍스트 LIKE '%계획%' OR 텍스트 LIKE '%업무%' OR 텍스트 LIKE '%일정%'
LIMIT 3;

-- 5. 맥락 차원 테스트 데이터 (개인 상황)
UPDATE 채팅메시지목록 
SET 맥락차원 = '{
  "상황유형": "개인",
  "작성목적": "기록",
  "환경정보": {
    "디바이스": "모바일",
    "집중도": 2
  },
  "위치정보": {
    "장소유형": "집"
  }
}'::jsonb
WHERE 텍스트 LIKE '%개인%' OR 텍스트 LIKE '%생각%' OR 텍스트 LIKE '%아이디어%'
LIMIT 2;

-- 6. 관계 차원 테스트 데이터 (메시지 유형)
UPDATE 채팅메시지목록 
SET 메시지유형 = '질문'
WHERE 텍스트 LIKE '%?%' OR 텍스트 LIKE '%어떻게%' OR 텍스트 LIKE '%무엇%'
LIMIT 3;

UPDATE 채팅메시지목록 
SET 메시지유형 = '아이디어'
WHERE 텍스트 LIKE '%아이디어%' OR 텍스트 LIKE '%생각%' OR 텍스트 LIKE '%제안%'
LIMIT 2;

-- 7. 노트에도 7차원 데이터 추가
UPDATE 노트목록 
SET 우선순위차원 = '{
  "우선순위레벨": 3,
  "긴급도": "이번주",
  "중요도매트릭스": {
    "긴급하고중요함": false,
    "중요하지만긴급하지않음": true,
    "긴급하지만중요하지않음": false,
    "긴급하지도중요하지도않음": false
  }
}'::jsonb,
노트유형 = '프로젝트'
WHERE 제목 LIKE '%프로젝트%' OR 제목 LIKE '%개발%'
LIMIT 2;

COMMIT;

-- ===== 변화 확인 쿼리들 =====

-- 1. 7차원 데이터가 적용된 메시지 개수 확인
SELECT 
  '7차원 데이터 적용 현황' as 구분,
  COUNT(*) as 총메시지수,
  COUNT(우선순위차원) as 우선순위설정수,
  COUNT(감정차원) as 감정기록수,
  COUNT(맥락차원) as 맥락기록수,
  ROUND(COUNT(우선순위차원)::numeric / COUNT(*) * 100, 1) as 우선순위비율,
  ROUND(COUNT(감정차원)::numeric / COUNT(*) * 100, 1) as 감정기록비율,
  ROUND(COUNT(맥락차원)::numeric / COUNT(*) * 100, 1) as 맥락기록비율
FROM 채팅메시지목록;

-- 2. 감정별 메시지 분포
SELECT 
  '감정 분포' as 구분,
  감정차원->'기분상태'->>'주감정' as 주감정,
  COUNT(*) as 개수,
  AVG((감정차원->'기분상태'->>'전체강도')::int) as 평균강도
FROM 채팅메시지목록 
WHERE 감정차원 IS NOT NULL
GROUP BY 감정차원->'기분상태'->>'주감정';

-- 3. 우선순위별 메시지 분포
SELECT 
  '우선순위 분포' as 구분,
  우선순위차원->>'긴급도' as 긴급도,
  우선순위차원->>'우선순위레벨' as 레벨,
  COUNT(*) as 개수
FROM 채팅메시지목록 
WHERE 우선순위차원 IS NOT NULL
GROUP BY 우선순위차원->>'긴급도', 우선순위차원->>'우선순위레벨';

-- 4. 상황별 메시지 분포
SELECT 
  '맥락 분포' as 구분,
  맥락차원->>'상황유형' as 상황유형,
  맥락차원->>'작성목적' as 작성목적,
  COUNT(*) as 개수
FROM 채팅메시지목록 
WHERE 맥락차원 IS NOT NULL
GROUP BY 맥락차원->>'상황유형', 맥락차원->>'작성목적';

-- 5. 메시지 유형 분포
SELECT 
  '메시지 유형 분포' as 구분,
  메시지유형,
  COUNT(*) as 개수,
  ROUND(COUNT(*)::numeric / (SELECT COUNT(*) FROM 채팅메시지목록) * 100, 1) as 비율
FROM 채팅메시지목록 
GROUP BY 메시지유형
ORDER BY 개수 DESC;

-- 6. 분석용 뷰 테스트
SELECT '우선순위 분석 뷰 테스트' as 구분, COUNT(*) as 데이터수 FROM 우선순위분석뷰;
SELECT '감정 추이 분석 뷰 테스트' as 구분, COUNT(*) as 데이터수 FROM 감정추이분석뷰;
SELECT '맥락별 활동 분석 뷰 테스트' as 구분, COUNT(*) as 데이터수 FROM 맥락별활동분석뷰;
SELECT '7차원 종합 분석 뷰 테스트' as 구분, COUNT(*) as 데이터수 FROM 칠차원종합분석뷰;

-- 7. 실제 7차원 데이터 샘플 확인
SELECT 
  '실제 7차원 데이터 샘플' as 구분,
  LEFT(텍스트, 50) as 텍스트샘플,
  우선순위차원->>'긴급도' as 긴급도,
  감정차원->'기분상태'->>'주감정' as 주감정,
  맥락차원->>'상황유형' as 상황유형,
  메시지유형
FROM 채팅메시지목록 
WHERE 우선순위차원 IS NOT NULL OR 감정차원 IS NOT NULL OR 맥락차원 IS NOT NULL
LIMIT 5;

-- 완료 메시지
SELECT 
  '🎉 7차원 테스트 데이터 생성 완료!' as 상태,
  '위 결과를 확인하여 7차원 시스템 작동 여부를 점검하세요.' as 안내;