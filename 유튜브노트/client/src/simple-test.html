<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íƒ€ì„ìŠ¤íƒ¬í”„ ì •ì§€ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .video-container { position: relative; width: 100%; height: 400px; background: #000; margin-bottom: 20px; }
        textarea { width: 100%; height: 200px; margin-bottom: 10px; padding: 10px; }
        button { padding: 10px 15px; margin-right: 10px; background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        .status { background: #f8f9fa; padding: 10px; border-radius: 5px; margin-top: 10px; }
        .timestamp { background: #e9ecef; padding: 2px 5px; cursor: pointer; }
        .timestamp:hover { background: #dee2e6; }
    </style>
</head>
<body>
    <div class="container">
        <h1>íƒ€ì„ìŠ¤íƒ¬í”„ ì •ì§€ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="video-container" id="player">
            <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: white;">
                YouTube ë™ì˜ìƒ ë¡œë“œ ëŒ€ê¸° ì¤‘...
            </div>
        </div>
        
        <div>
            <input type="text" id="videoInput" placeholder="YouTube ì˜ìƒ ID ë˜ëŠ” URL ì…ë ¥" style="width: 70%; padding: 10px;">
            <button onclick="loadVideo()">ì˜ìƒ ë¡œë“œ</button>
        </div>
        
        <textarea id="noteArea" placeholder="í…ŒìŠ¤íŠ¸ìš© íƒ€ì„ìŠ¤íƒ¬í”„:

[00:00:10-00:00:15, 100%, 1.00x, |3] - 3ì´ˆ ì •ì§€ í…ŒìŠ¤íŠ¸
[00:00:20-00:00:25, 100%, 1.00x, ->] - ìë™ì í”„ í…ŒìŠ¤íŠ¸  
[00:00:30-00:00:35, 100%, 1.00x] - ì¼ë°˜ êµ¬ê°„ì¬ìƒ í…ŒìŠ¤íŠ¸

ì‚¬ìš©ë²•: íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ ë”ë¸”í´ë¦­í•˜ë©´ í•´ë‹¹ ì‹œê°„ìœ¼ë¡œ ì´ë™í•˜ê³  ê¸°ëŠ¥ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.
- |ìˆ«ì: í•´ë‹¹ ì´ˆë§Œí¼ ì •ì§€ í›„ ì¬ìƒ
- ->: êµ¬ê°„ ëì—ì„œ ë‹¤ìŒ íƒ€ì„ìŠ¤íƒ¬í”„ë¡œ ìë™ ì´ë™
- ì—†ìŒ: êµ¬ê°„ ëì—ì„œ ì •ì§€"></textarea>
        
        <button onclick="addTimestamp()">í˜„ì¬ì‹œê°„ íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€</button>
        <button onclick="testPause()">ì •ì§€ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</button>
        
        <div class="status" id="status">
            ìƒíƒœ: ì¤€ë¹„ë¨
        </div>
    </div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let player = null;
        let isPlayerReady = false;

        // YouTube API ì¤€ë¹„ ì½œë°±
        function onYouTubeIframeAPIReady() {
            updateStatus('YouTube API ë¡œë“œë¨. ì˜ìƒì„ ë¡œë“œí•˜ì„¸ìš”.');
        }

        // ì˜ìƒ ë¡œë“œ
        function loadVideo() {
            const input = document.getElementById('videoInput').value;
            let videoId = input;
            
            // URLì—ì„œ videoId ì¶”ì¶œ
            if (input.includes('youtube.com/watch?v=')) {
                videoId = input.split('v=')[1].split('&')[0];
            } else if (input.includes('youtu.be/')) {
                videoId = input.split('youtu.be/')[1].split('?')[0];
            }
            
            if (!videoId) {
                alert('ìœ íš¨í•œ YouTube ì˜ìƒ IDë‚˜ URLì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }

            if (player) {
                player.destroy();
            }

            player = new YT.Player('player', {
                height: '400',
                width: '100%',
                videoId: videoId,
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange,
                    'onError': onPlayerError
                }
            });
        }

        function onPlayerReady(event) {
            isPlayerReady = true;
            updateStatus('í”Œë ˆì´ì–´ ì¤€ë¹„ë¨. íƒ€ì„ìŠ¤íƒ¬í”„ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥.');
        }

        function onPlayerStateChange(event) {
            const states = ['ì¢…ë£Œ', 'ì¬ìƒì¤‘', 'ì¼ì‹œì •ì§€', 'ë²„í¼ë§', '?', 'ì¤€ë¹„ë¨'];
            updateStatus(`í”Œë ˆì´ì–´ ìƒíƒœ: ${states[event.data + 1] || 'ì•Œìˆ˜ì—†ìŒ'}`);
        }

        function onPlayerError(event) {
            updateStatus(`í”Œë ˆì´ì–´ ì˜¤ë¥˜: ${event.data}`);
        }

        function updateStatus(message) {
            document.getElementById('status').textContent = 'ìƒíƒœ: ' + message;
            console.log('ğŸ“±', message);
        }

        // íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€
        function addTimestamp() {
            if (!player || !isPlayerReady) {
                alert('í”Œë ˆì´ì–´ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }

            const currentTime = player.getCurrentTime();
            const endTime = currentTime + 5;
            
            const formatTime = (seconds) => {
                const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
                const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
                const s = (seconds % 60).toFixed(0).padStart(2, '0');
                return `${h}:${m}:${s}`;
            };

            const timestamp = `[${formatTime(currentTime)}-${formatTime(endTime)}, 100%, 1.00x]`;
            
            const noteArea = document.getElementById('noteArea');
            noteArea.value += '\n' + timestamp + ' ';
            
            updateStatus(`íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€ë¨: ${timestamp}`);
        }

        // ì •ì§€ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
        function testPause() {
            if (!player || !isPlayerReady) {
                alert('í”Œë ˆì´ì–´ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }

            updateStatus('3ì´ˆ ì •ì§€ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            player.pauseVideo();
            
            setTimeout(() => {
                player.playVideo();
                updateStatus('3ì´ˆ ì •ì§€ í›„ ì¬ìƒ ì¬ê°œë¨');
            }, 3000);
        }

        // íƒ€ì„ìŠ¤íƒ¬í”„ í´ë¦­ ì²˜ë¦¬
        document.getElementById('noteArea').addEventListener('dblclick', function(e) {
            if (!player || !isPlayerReady) {
                alert('í”Œë ˆì´ì–´ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }

            const text = this.value;
            const clickPosition = this.selectionStart;
            
            // íƒ€ì„ìŠ¤íƒ¬í”„ ì •ê·œì‹
            const timestampRegex = /\[(\d{2}):(\d{2}):(\d{2})-(\d{2}):(\d{2}):(\d{2}),\s*(\d+)%,\s*([\d.]+)x(?:,\s*(->|\|\d+))?\]/g;
            let match;
            let clickedTimestamp = null;

            // í´ë¦­ëœ ìœ„ì¹˜ì˜ íƒ€ì„ìŠ¤íƒ¬í”„ ì°¾ê¸°
            while ((match = timestampRegex.exec(text)) !== null) {
                if (clickPosition >= match.index && clickPosition <= match.index + match[0].length) {
                    clickedTimestamp = match;
                    break;
                }
            }

            if (clickedTimestamp) {
                // ì‹œê°„ ê³„ì‚°
                const startHours = parseInt(clickedTimestamp[1]);
                const startMinutes = parseInt(clickedTimestamp[2]);
                const startSeconds = parseInt(clickedTimestamp[3]);
                const endHours = parseInt(clickedTimestamp[4]);
                const endMinutes = parseInt(clickedTimestamp[5]);
                const endSeconds = parseInt(clickedTimestamp[6]);
                
                const startTime = startHours * 3600 + startMinutes * 60 + startSeconds;
                const endTime = endHours * 3600 + endMinutes * 60 + endSeconds;
                const volume = parseInt(clickedTimestamp[7]);
                const speed = parseFloat(clickedTimestamp[8]);
                const action = clickedTimestamp[9];

                // ì„¤ì • ì ìš©
                player.setVolume(volume);
                player.setPlaybackRate(speed);
                player.seekTo(startTime, true);
                player.playVideo();

                // ì•¡ì…˜ë³„ ì²˜ë¦¬
                if (action && action.startsWith('|')) {
                    // ì •ì§€ ëª¨ë“œ
                    const pauseSeconds = parseInt(action.substring(1));
                    updateStatus(`ì¬ìƒ ì‹œì‘ - ${pauseSeconds}ì´ˆ í›„ ìë™ ì •ì§€`);
                    
                    setTimeout(() => {
                        if (player.getPlayerState() === 1) { // ì¬ìƒ ì¤‘ì¼ ë•Œë§Œ
                            player.pauseVideo();
                            updateStatus(`${pauseSeconds}ì´ˆ ì •ì§€ ì™„ë£Œ`);
                        }
                    }, pauseSeconds * 1000);
                    
                } else if (action === '->') {
                    // ìë™ì í”„ ëª¨ë“œ
                    const segmentDuration = (endTime - startTime) * 1000;
                    updateStatus(`ì¬ìƒ ì‹œì‘ - ${(endTime - startTime).toFixed(1)}ì´ˆ í›„ ë‹¤ìŒ ìŠ¤íƒ¬í”„ë¡œ ìë™ ì´ë™`);
                    
                    setTimeout(() => {
                        if (player.getPlayerState() === 1) {
                            updateStatus('êµ¬ê°„ ì™„ë£Œ - ë‹¤ìŒ íƒ€ì„ìŠ¤íƒ¬í”„ ì°¾ëŠ” ì¤‘...');
                        }
                    }, segmentDuration);
                    
                } else {
                    // ì¼ë°˜ ëª¨ë“œ
                    const segmentDuration = (endTime - startTime) * 1000;
                    updateStatus(`êµ¬ê°„ ì¬ìƒ ì‹œì‘: ${startTime}ì´ˆ - ${endTime}ì´ˆ (${(endTime - startTime).toFixed(1)}ì´ˆ)`);
                    
                    setTimeout(() => {
                        if (player.getPlayerState() === 1) {
                            player.pauseVideo();
                            updateStatus('êµ¬ê°„ ì¬ìƒ ì™„ë£Œ');
                        }
                    }, segmentDuration);
                }
            }
        });
    </script>
</body>
</html>