# 프리셋 설정 데이터베이스 마이그레이션 계획

## 현재 상태 (2025-08-05)
- **저장 방식**: localStorage (클라이언트 측)
- **저장 위치**: 브라우저 로컬 스토리지
- **데이터 구조**: 
```json
{
  "uiSettings": {
    "프리셋": {
      "최소모드명": "사용자 정의 이름",
      "노트모드명": "사용자 정의 이름"
    },
    "상단부": { "제목표시": true, "부제목표시": true, "부제목내용": "..." },
    "검색창": { "표시": true, "자동숨김": false },
    "재생컨트롤": { "전체표시": true, "볼륨": true, "속도": true, "도장": true, "녹화": true },
    "노트영역": { "표시": true },
    "화면텍스트": { "패널표시": true, "좌표설정": true, "스타일설정": true, "빠른설정": true }
  }
}
```

## 데이터베이스 마이그레이션 계획

### 1. 데이터베이스 테이블 설계
```sql
-- 사용자 프리셋 테이블
CREATE TABLE user_presets (
  id VARCHAR(36) PRIMARY KEY,
  user_id VARCHAR(100) NOT NULL,
  preset_name VARCHAR(50) NOT NULL,
  preset_type ENUM('최소', '노트', '커스텀') NOT NULL,
  settings JSON NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_user_presets (user_id, preset_type)
);

-- 기본 설정 템플릿 테이블
CREATE TABLE preset_templates (
  id VARCHAR(36) PRIMARY KEY,
  template_name VARCHAR(50) NOT NULL,
  template_type ENUM('최소', '노트', '전체', '기본') NOT NULL,
  default_settings JSON NOT NULL,
  is_system_default BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 2. 마이그레이션 단계

#### Phase 1: 하이브리드 운영
- localStorage 유지하면서 데이터베이스 병행 사용
- 사용자 로그인 시 localStorage → DB 동기화
- 로그아웃 시에도 localStorage 백업 유지

#### Phase 2: 점진적 이전
- 신규 사용자는 데이터베이스만 사용
- 기존 사용자는 첫 로그인 시 자동 마이그레이션
- localStorage 데이터를 DB로 일회성 이전

#### Phase 3: 완전 전환
- localStorage 의존성 제거
- 데이터베이스 전용 운영
- 오프라인 캐싱만 localStorage 활용

### 3. API 설계
```typescript
// 프리셋 관련 API
interface PresetAPI {
  // 사용자 프리셋 목록 조회
  getUserPresets(userId: string): Promise<UserPreset[]>;
  
  // 프리셋 저장/업데이트
  savePreset(userId: string, preset: PresetData): Promise<void>;
  
  // 프리셋 삭제
  deletePreset(userId: string, presetId: string): Promise<void>;
  
  // 기본 템플릿 조회
  getDefaultTemplates(): Promise<PresetTemplate[]>;
}
```

### 4. 프론트엔드 변경사항
- 상태 관리를 서버 동기화 방식으로 변경
- 오프라인 상태에서도 동작하도록 캐싱 전략 구현
- 설정 변경 시 실시간 서버 동기화

### 5. 주의사항
- **데이터 일관성**: 여러 기기에서 동시 수정 시 충돌 해결
- **성능**: 설정 변경 시 즉시 DB 저장 vs 배치 저장
- **오프라인 지원**: 네트워크 없을 때 localStorage 폴백
- **데이터 백업**: 사용자 설정 손실 방지

### 6. 타임라인
- **2025년 Q1**: Phase 1 - 하이브리드 시스템 구축
- **2025년 Q2**: Phase 2 - 점진적 마이그레이션 시작
- **2025년 Q3**: Phase 3 - 완전 전환 완료

---
*문서 작성일: 2025-08-05*
*최종 업데이트: localStorage → DB 마이그레이션 계획 수립*